<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE book 
[
<!ENTITY % entities SYSTEM 'catalog.ent'>
<!ENTITY % local.common.attrib "infoid CDATA #IMPLIED">
<!ATTLIST bookinfo code CDATA #REQUIRED>
%entities;
]>

<book id="ana_man%book">
  <bookinfo code='ana_man'>
    <title>Anatomist : user manual</title>
    <edition>Manual for Anatomist software</edition>
  </bookinfo>
    
    <chapter>
      <title>Introduction</title>
      <para>Anatomist software enables objects visualization and handling for medical imaging. These objects are various representations of anatomical and functional information coming from images (T1 MRI, activation image issued from a parametrical statistical map, PET, hemispheres mesh, fibers bundles obtained from BrainVISA tracking process, sulci graph representation extracted from a T1 MRI image...). </para>
      <para>Features and originality of Anatomist are based on :</para>
      <itemizedlist>
        <listitem>
          <para>Management of several types of objects : structured (sulci, ROI graphs...) or not (3D, 4D volumes, mesh ...)  </para>
        </listitem>
        <listitem>
          <para>Management of coordinate systems and transformations, for instance, you can load transformation matrix to change the object coordinate systems.
          For example, it is possible to merge a non normalized anatomical volume and a normalized activation map (functional data), and to have a coherent display if we load the transformation from the normalized image to the non normalized anatomical image or the reverse.
        </para>
        </listitem>
        <listitem>
          <para>Possibility of building complex 3D scenes with several objects of any type (merging, superimposing...).</para>
        </listitem>
        <listitem>
          <para>A lot of tools : color palettes, region of interest module, mathematic morphology, manual registration (transformation control) ...</para>
        </listitem>
      </itemizedlist> 
      
      <para>Anatomist control window (main window) enables to have a general view of loaded objects and opened windows, to choose actions for combining objects (merging...), or controls to use on windows according to contained objects. Here's Anatomist control window :</para>
       <figure><title>Anatomist control window</title>
         <mediaobject>
           <imageobject role="fop"><imagedata fileref="&DIR_IMG;control_window0.png" format="PNG"  width="350"/></imageobject>
           <imageobject role="html"><imagedata fileref="&DIR_IMG;control_window0.png" format="PNG"/></imageobject>
	 </mediaobject>
      </figure>
      
      <para>General purpose is to load objects (volume, ROI graph, mesh...), change their referential (coordinate system) if needed, modify their characteristics, combining them (merging, superimposing...), and put them in windows in order to visualize them. </para>
      <para>So, here are some base principles for using Anatomist :</para>
      <orderedlist>
        <listitem>
          <para>Load <emphasis role='bold'>objects</emphasis> that represent volumes, meshes ...</para>
        </listitem>
        <listitem>
          <para>These <emphasis role='bold'>objects</emphasis> are put in <emphasis role='bold'>windows</emphasis>  for visualization. At a more advanced level of use, it is possible to put several objects in the same windows, for example to superimpose a mesh and a volume. </para>
        </listitem>
        <listitem>
          <para>It is also possible to handle <emphasis role='bold'>objects</emphasis> characteristics as <emphasis role='bold'>referential</emphasis> (coordinate system) or <emphasis role='bold'>colors</emphasis>, for example by modifying a volume's palette.</para>
        </listitem>
        <listitem>
          <para>A window offers different <emphasis role='bold'>control</emphasis> modes according to the type of its contained objects. For example, if a window contains a ROI graph, the <emphasis>selection</emphasis>control will be available and will enable to select regions in the graph.</para>
        </listitem>
      </orderedlist> 
      
      <para>Here are some examples about typical actions in Anatomist, for example to look at a volume :</para>
       <figure><title>Visualize and handle a volume with Anatomist</title>
           <mediaobject>
             <videoobject role="html"><videodata fileref='&DIR_VIDEO;intro.swf' width="563" height="541" /></videoobject>
             <imageobject role="fop"><imagedata fileref="&DIR_IMG;introana.png" format="PNG"  width="350"/></imageobject>
           </mediaobject>
      </figure>
    </chapter>
   
    <chapter>
      <title>Install and start Anatomist software</title>
      <para>See <ulink url="#bv_man%book">BrainVISA manual</ulink> (installation under Windows, installation under Linux, installation under MacOs). </para>
      <para>See <ulink url="#doxyana%index"> Anatomist project sources</ulink> page. </para>
      <para>See <ulink url="#ana_training%book"> Anatomist tutorial</ulink> page. </para>
    </chapter>

    <chapter><title>Configuration</title>
      <sect1>
        <title>Configuration menus</title>
        <para>When starting to use Anatomist, you need to configure some options. The most important is to choose (or to check if several users share the same Anatomist configuration) how to display axial and coronal views : either in radiological convention or in neurological convention.</para>
	<para>To go to preferences pannel, click on <emphasis>Settings</emphasis> and on <emphasis>Preferences</emphasis>. Let's see the different menus :
       </para>
        <sect2>
          <title><emphasis>Application</emphasis> menu
          </title>
          
	  <figure><title><emphasis>Application</emphasis> tab</title>
          <mediaobject>
            <imageobject role='fop'><imagedata fileref="&DIR_IMG;settings0.png" format="PNG"  width="350" /></imageobject>
            <imageobject role='html'><imagedata fileref="&DIR_IMG;settings0.png" format="PNG"/></imageobject>
          </mediaobject>
	  </figure>
	  
          <itemizedlist>
            <listitem>
              <para>
                <emphasis>Language  </emphasis>: <emphasis>default</emphasis> (system language) / <emphasis>en</emphasis>    (english) / <emphasis>fr</emphasis> (french).</para>
            </listitem>
            <listitem>
              <para>
                <emphasis>HTML browser command line </emphasis>: the browser that will be used to see HTML documentation (mozilla / netscape .....).</para>
            </listitem>
            <listitem>
              <para>
                <emphasis>User level </emphasis>: basic, advanced or expert. Some features are available only in advanced or expert mode, for example flight simulator control and storage to memory transformation automatic loading.</para>
            </listitem>
            <listitem>
              <para>
                <emphasis>Default referentials </emphasis>: this advanced option enables to choose a default referential for loaded object and for new windows independently. By clicking on the grey button, you can choose them with :</para>
              
	      <figure><title>Default referentials configuration</title>
                <mediaobject>
                  <imageobject role="fop"><imagedata fileref="&DIR_IMG;settings1.png" format="PNG"  width="130"/></imageobject>
	          <imageobject role="html"><imagedata fileref="&DIR_IMG;settings1.png" format="PNG"/></imageobject>
		</mediaobject>
              </figure>
	      
            </listitem>
          </itemizedlist>
        </sect2>
        <sect2>
          <title><emphasis>Linked cursor</emphasis> menu
          </title>
          
          <figure><title><emphasis>Linked cursor</emphasis>tab</title>
           <mediaobject>
             <imageobject role="fop"><imagedata fileref="&DIR_IMG;settings2.png" format="PNG"  width="430"/></imageobject>
             <imageobject role="html"><imagedata fileref="&DIR_IMG;settings2.png" format="PNG"/></imageobject>
		</mediaobject>
              </figure>
	  
	  
          <itemizedlist>
            <listitem>
              <para>
                <emphasis>Display linked cursor </emphasis>: if enabled, a symbol is displayed to represent the linked cursor position when you click on a window.</para>
            </listitem>
            <listitem>
              <para>
                <emphasis>Cursor shape </emphasis>: the menu offers several shapes to choose (arrow, cross, multicross ...). It is also possible to load a cursor (only meshes, .tri and .mesh will be displayed in 3D).
	      
	     </para>
            </listitem>
            <listitem>
              <para>
                <emphasis>Size </emphasis>: set cursor size.</para>
            </listitem>
            <listitem>
              <para>
                <emphasis>Cursor color </emphasis>: default color is red. You can choose another color.</para>
            </listitem>
          </itemizedlist>
        </sect2>
        <sect2>
          <title><emphasis>Windows</emphasis> menu
          </title>
	      <figure><title><emphasis>Windows</emphasis> tab</title>
               <mediaobject>
                 <imageobject role="fop"><imagedata fileref="&DIR_IMG;settings3.png" format="PNG"  width="430"/></imageobject>
                 <imageobject role="html"><imagedata fileref="&DIR_IMG;settings3.png" format="PNG"/></imageobject>
		</mediaobject>
              </figure>		  
          <itemizedlist>
            <listitem>
              <para>
                <emphasis>Axial/coronal slices orientation</emphasis> : selection of images display convention.</para>
            </listitem>
            <listitem>
              <para>
                <emphasis>Default windows size </emphasis>: windows zoom factor, by default the value is 1 for a volume whose voxels size is (1x1x1). So on screen, a pixel size is 1mm.</para>
            </listitem>
          </itemizedlist>
        </sect2>
        <sect2>
          <title><emphasis>Control window</emphasis> menu
          </title>
          <figure><title><emphasis>Control window</emphasis> tab</title>
               <mediaobject>
                 <imageobject role="fop"><imagedata fileref="&DIR_IMG;settings4.png" format="PNG"  width="430"/></imageobject>
                 <imageobject role="html"><imagedata fileref="&DIR_IMG;settings4.png" format="PNG"/></imageobject>
		</mediaobject>
              </figure>		  
	  
          <itemizedlist>
            <listitem>
              <para>
                <emphasis>Display nice logo </emphasis>: enable displaying of Anatomist logo on top of the main window.</para>
            </listitem>
          </itemizedlist>
        </sect2>
        <sect2>
          <title><emphasis>Volumes</emphasis> menu</title>
	      <figure><title><emphasis>Volumes</emphasis> tab</title>
               <mediaobject>
                 <imageobject role="fop"><imagedata fileref="&DIR_IMG;settings5.png" format="PNG"  width="430"/></imageobject>
                 <imageobject role="html"><imagedata fileref="&DIR_IMG;settings5.png" format="PNG"/></imageobject>
		</mediaobject>
              </figure>
	  
          <itemizedlist>
            <listitem>
              <para>
                <emphasis>Interpolation on volumes when changing referential</emphasis>: on loading a referential for an image (applying a transformation) or during a fusion, the volume is resampled by a trilinear interpolation or by the closest sibling value.</para>
            </listitem>
            <listitem>
              <para>
                <emphasis>Use referential / transformations information found in objects headers (SPM, NIFTI...) </emphasis>: if a loaded image has <emphasis>spm_origin, transformations, or referentials</emphasis> attributes in its header, it is possible to automatically load the corresponding referentials and transformations in Anatomist.
                See <xref linkend="ana_man%apply_builtin_referential"/> to know more about this feature.</para>
            </listitem>
          </itemizedlist>
        </sect2>
      </sect1>
      <sect1>
        <title>Preferences validation</title>
        <para>To keep these preferences for further sessions, you must save them :</para>
	
	 <figure>   <title><emphasis>Preferences</emphasis> validation</title>
         <mediaobject>
           <imageobject role="fop"><imagedata fileref="&DIR_IMG;settings6.png" format="PNG"  width="360"/></imageobject>
           <imageobject role="html"><imagedata fileref="&DIR_IMG;settings6.png" format="PNG"/></imageobject>
	 </mediaobject>
         </figure>		
	
        <para>If the configuration file is shared between several users, make sure that you all use the same preferences and regularly check that your parameters haven't been changed. Indeed, if a user modifies a parameter like the  display convention (neurological or radiological), images display will change. Configuration is shared if you are identified as the same user.</para>
      </sect1>
      <sect1>
        <title>Customized configuration</title>
        <para>You can start Anatomist with a customized configuration even if you share the same user with other people. To use a particular profile, start Anatomist with a profile name (even if it doesn't exists yet). For example : </para>
        <screen>anatomist -u toto</screen>
        <para>and then save preferences to keep them for a further session.</para>
        <para>Every profile has its own configuration directory, which is localized according to the system (<emphasis>user</emphasis> is the login used to connect to the computer, it can be for example your name) : </para>
        <itemizedlist>
          <listitem>
            <para>Under Linux :</para>
            <screen>/home/user/.anatomist-toto</screen>
          </listitem>
          <listitem>
            <para>Under Windows :</para>
            <screen>C:\Documents and Settings\user\.anatomist-toto\</screen>
          </listitem>
        </itemizedlist>
        <para>To start Anatomist with this profile :</para>
        <screen>anatomist -u toto</screen>
      </sect1>
    </chapter>
    <!-- fin de configuration -->
    <chapter><title>Windows</title>
      <para>A window enable to visualize one or several objects. These objects can have the same type (e.g. : 2 meshes for the brain hemispheres) or different types (e.g. : a mesh and a volume). 
      Windows have a name, for example  <emphasis>A(2):anat.vimg</emphasis>. This name means that the window is the second axial window and contains the volume <emphasis>anat.vimg</emphasis>. 
      It is possible to handle windows individually or in groups.</para>
        <para>There are several ways to open a window :
	<itemizedlist>
          <listitem>Menu <emphasis>Windows => &lt;Choose window's type&gt;</emphasis></listitem>
          <listitem>Click on window type icon</listitem>
        </itemizedlist>
       </para>
      <sect1>
        <title>Windows types</title>
        <para>Windows enable to visualize objects after their loading. Note that visualization is different from loading. Indeed, loading gives raw data that can be visualized in various way. For example, you can change the display convention without modifying the data. See <xref linkend="ana_man%load_and_display_objects"/> for more details.</para>
        <para>The table below shows the different window types.</para>
        <table>
          <title>Windows</title>
          <tgroup align="justify" cols="2">
            <thead>
              <row>
                <entry> Icon</entry>
                <entry> Description</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>&window-axial-small;</entry>
                <entry><para> 2D Axial window - Visualization of volumes.</para></entry>
              </row>
              <row>
                <entry>&window-coronal-small;</entry>
                <entry><para> 2D Coronal window - Visualization of volumes.</para></entry>
              </row>
              <row>
                <entry>&window-sagittal-small;</entry>
                <entry><para> 2D Sagittal window - Visualization of volumes.</para></entry>
              </row>
              <row>
                <entry>&window-oblique-small;</entry>
                <entry><para><link linkend="ana_man%a_winoblique">2D Oblique window</link>.</para></entry>
              </row>
              <row>
                <entry>&window-3d-small;</entry>
                <entry><para> 3D window - Visualization of 2D objects and 3D objects (for example meshes).</para></entry>
              </row>
              <row>
                <entry>&window-browser-small;</entry>
                <entry><para> Browser - Visualization of object attributes, window content or structured objects.</para></entry>
              </row>
              <row>
                <entry>&window-profile-small;</entry>
                <entry><para> Profile - Visualization of grey levels range along an axis.</para></entry>
              </row>
            </tbody>
          </tgroup>
        </table>
        <para>You can switch from one type to another by clicking on the icons on window's top bar. </para>

        <sect2 id="ana_man%a_winoblique" infoid="utilisation de la vue oblique">
          <title>Oblique window</title>
          <para>This type of window enables to see an oblique slice and <emphasis>buckets</emphasis> (set of voxels), that are displayed differently in 2D and in 3D. This window enables to keep the slice orientation as if you were in a 3D window but to display buckets as if you were in a 2D window.</para>
          <para>The following images show the difference between 3D, 2D and oblique windows for MRI and ROI visualization :</para>
          
          <figure>
            <title>3D window</title>
            <mediaobject>
              <imageobject role="fop"><imagedata fileref="&DIR_IMG;win-oblique1.png" format="PNG"  width="250"/></imageobject>
              <imageobject role="html"><imagedata fileref="&DIR_IMG;win-oblique1.png" format="PNG"/></imageobject>
            </mediaobject>
          </figure>	
          
          <figure>
            <title>Oblique window</title>
            <mediaobject>
              <imageobject role="fop"><imagedata fileref="&DIR_IMG;win-oblique2.png" format="PNG"  width="250"/></imageobject>
              <imageobject role="html"><imagedata fileref="&DIR_IMG;win-oblique2.png" format="PNG"/></imageobject>
            </mediaobject>
          </figure>	
          
          <figure>
            <title>Axial window (2D)</title>
            <mediaobject>
              <imageobject role="fop"><imagedata fileref="&DIR_IMG;win-oblique3.png" format="PNG"  width="250"/></imageobject>
              <imageobject role="html"><imagedata fileref="&DIR_IMG;win-oblique3.png" format="PNG"/></imageobject>
            </mediaobject>
          </figure>	    
        </sect2>   

      </sect1>
      <sect1>
        <title>Windows groups</title>
        <para>Windows can be grouped in order to :</para>
        <itemizedlist>
          <listitem>
            <para>Use a linked cursor specific for the group ( don't forget to enable <emphasis>Settings => Preferences => Linked  cursor => Display linked cursor</emphasis> option).</para>
          </listitem>
          <listitem>
            <para>Handle the same object in all windows of the group : click on <emphasis>View / select objects</emphasis> contextual menu in a window of the group, a browser appears. Select the object in the browser. Note : by default all windows are considered to be in the same group and objects can be selected in all windows via any browser window.</para>
          </listitem>
        </itemizedlist>
        <para>
          <emphasis role="bold">To create a windows group : </emphasis>
          <orderedlist numeration="arabic">
            <listitem>
              <para>Select the windows to link in the windows panel (on the right). For multiple selection, press <emphasis>Ctrl</emphasis> key and click.</para>
            </listitem>
            <listitem>
              <para>Then create the group with <emphasis>Windows => Link windows</emphasis> menu.
              </para>
            </listitem>
          </orderedlist>
        </para>
	<para>
            <emphasis role="bold">To undo a windows group :</emphasis>
          <orderedlist numeration="arabic">
          <listitem>
            <para>Select the group on right panel.
            </para>
          </listitem>
          <listitem>
            <para>Undo the group with <emphasis>Windows => Unlink windows</emphasis>
            </para>
          </listitem>
        </orderedlist></para>
      </sect1>
 
      <sect1>
        <title>Windows blocks</title>
        <para>A windows block is a window that can contain several views.</para>
        <para>Select the image you want to visualize. Open a 4 views block using the <emphasis>Windows => Open a 4 views block</emphasis> menu.</para>
        <figure>
            <title>4 views block</title>
            <mediaobject>
              <imageobject role="fop"><imagedata fileref="&DIR_IMG;windows_block.png" format="PNG"  width="400"/></imageobject>
              <imageobject role="html"><imagedata fileref="&DIR_IMG;windows_block.png" format="PNG"/></imageobject>
            </mediaobject>
        </figure>	    
        <para>You can add a new window to the block by dragging the window item from Anatomist's list of windows and dropping it in the block.</para>
        <para>To remove a window from the block, use the window menu <emphasis>Window => Detach view</emphasis>.</para>
      </sect1>

      <sect1>
        <title>Window contextual menu</title>
        <para>Each window has a contextual menu that appears when right-clicking on the window. The menu is explained below :</para>
        <table>
          <title>Windows menu</title>
          <tgroup align="justify" cols="2">
            <thead>
              <row>
                <entry> Option</entry>
                <entry> Description</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>
                  <para>
                    <emphasis>View / select objects</emphasis>
                  </para>
                </entry>
                <entry>
                  <para> Opens a <emphasis>browser</emphasis> window that lists the window contained objects. Enables to select an object in the list in order to handle it in the window.</para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    <emphasis>Unselect</emphasis>
                  </para>
                </entry>
                <entry>
                  <para> Unselects all selected objects in the window.</para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    <emphasis>Select all</emphasis>
                  </para>
                </entry>
                <entry>
                  <para> Selects all objects contained in the window.</para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    <emphasis>Remove from windows of this group</emphasis>
                  </para>
                </entry>
                <entry>
                  <para> Removes selected objects from all windows of the group.</para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    <emphasis>Remove from this window</emphasis>
                  </para>
                </entry>
                <entry>
                  <para> Removes selected objects from this window.</para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    <emphasis>Objects manipulations</emphasis>
                  </para>
                </entry>
                <entry>
                  <para> Shows a menu that offers some actions on selected objects.</para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    <emphasis>Select neighbours</emphasis>
                  </para>
                </entry>
                <entry>
                  <para> This menu appears if the window contains a graph with selected nodes. Graphs are structured objects compound of nodes, which have their own properties, and relations between nodes. This menu shows and selects neighbouring nodes in the graph. It is useful to explore a region without missing a node. </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    <emphasis>Select nodes of attributes...</emphasis>
                  </para>
                </entry>
                <entry>
                  <para> This menu appears when window contains a graph with selected nodes. Enables to search for nodes and select them on node attribute criterion (name...)</para>
                </entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </sect1>
    </chapter>
    
    
      <chapter><title>Objects</title>
      <sect1>
        <title>Objects handled by Anatomist</title>
        <para>Object stands for all type of data that Anatomist can handle. This software manages volumes (T1, fMRI, ...), meshes, textures (to stick on other objects), structured objects like sulci graphs or ROI graphs. All these objects can be visualized and combined (merging, superimposing...). Some data types and formats are peculiar to Anatomist, like for example meshes (.mesh or .tri), or nomenclature (.hie).</para>
        <para>Main objects handled by Anatomist are listed below (the list is not exhaustive because there are also merged objects, volume slices...) :</para>
        <table>
          <title>Formats managed by Anatomist (non exhaustive list)</title>
          <tgroup align="justify" cols="3">
            <thead>
              <row>
                <entry>Icon</entry>
                <entry>Format / Extension / Anatomist data type</entry>
                <entry>Description</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>&list_volume;</entry>
                <entry>
                  <para>2D, 3D and 4D volume.
                  </para>
                </entry>
                <entry>
                  <para>Formats list, non exhaustive, according to the operating system (linux, windows...) :</para>
		<itemizedlist>
                      <listitem>
                        <para><!-- faire lien --> GIS/tivoli : .ima (volume data), .dim (header file) and .minf (attributes list).</para>
                      </listitem>
                      <listitem>
                        <para><!-- faire lien -->  Analyze (SPM) : .img (volume data) .hdr (header file).</para>
                      </listitem>
                     <listitem>
                        <para><!-- faire lien -->  NIFTI : .nii (only one file).</para>
                      </listitem>
                      <listitem>
                        <para>Genesis : .adv </para>
                      </listitem>
                      <listitem>
                        <para>CAPP/ECAT : </para>
                      </listitem>
                      <listitem>
                        <para><!-- faire lien -->  DICOM : .* or .dcm </para>
                      </listitem>
                      <listitem>
                        <para>VIDA : .vimg (volume data), .vdhr (header file) et .vinfo (attributes list).</para>
                      </listitem>
                      <listitem>
                        <para>MINC : .mnc </para>
                      </listitem>
                      <listitem>
                        <para>JPEG, GIF, PNG ..... : .jpg, .jpeg, .gif, .png .....</para>
                      </listitem>
                      <!-- liste non exhaustive : faire une annexe avec le spbs selon les os-->
                    </itemizedlist></entry>
              </row>
              <row>
                <entry>
                  <para> Script (no icon)</para>
                </entry>
                <entry><para>.ana</para></entry>
                <entry> Script to execute a sequence of actions. For example, a script can be a file containing commands to merge two volumes and load a specific palette. </entry>
              </row>
              <row>
                <entry>
		  &list_bucket;
                </entry>
                <entry><para>Bundles : .bundles</para><para>Bucket : .bck</para></entry>
                <entry><para>Bundles are sets of fibers obtained by tracking. It is handled as a graph.</para><para>A bucket is a set of points coprresponding for example to a region of interest, ie a voxels list (it is not possible to see the coordinates, only display is managed).</para></entry>
              </row>
              <row>
                <entry>
		  &list_surface;
                </entry>
                <entry><para>Mesh : .tri ou .mesh</para></entry>
                <entry> Files storing meshes ( 3D mesh of hemispheres, brain, cortex...).</entry>
              </row>
              <row>
                <entry>  &list_fusion2d;
                </entry>
                <entry><para>FUSION2D Object</para></entry>
		<entry><para>Object created by merging objects with Fusion2D method (for example : merging two volumes).</para></entry>
              </row>
              <row>
                <entry>&list_fusion3d;</entry>
                <entry><para>FUSION3D Object</para><para>Texture : .tex, .val ou .erp</para></entry>
                <entry><para>Object created by merging objects with Fusion3D method (for example : merging a volume and a mesh).</para> <para>Texture file<!-- faire lien -->, containing data to stick on meshes.</para></entry>
              </row>
              <row>
                <entry>&list_cutmesh;</entry>
                <entry><para>CutMesh object</para></entry>
		<entry><para>Object created by merging objects with CutMesh method (for example : merging a volume and a mesh).</para></entry>
              </row>
              <row>
                <entry>&list_planarfusion;</entry>
                <entry><para>PlanarFusion3D object</para></entry>
		<entry><para>Object (textured plan) obtained by merging a mesh slice plan (Planar mesh) and a volume. For example, in a FusionCutMeshMethod fusion between a volume and a mesh, PlanarFusion3D object will be the textured plan of the volume according to the slice plan of the mesh.</para></entry>
              </row>
              <row>
                <entry>&list_graph;</entry>
                <entry><para>Graph : .arg et .data</para></entry>
                <entry> .arg file is associated to a .data directory, and enables to organize data as a graph (sulci graph, region of interest graph...)</entry>
              </row>
              <row>
                <entry>&list_nomenclature;</entry>
                <entry><para>Nomenclature : .hie</para></entry>
                <entry>File containing a hierarchy of names or label. It enables to do hierarchical selections in a graph : you can select via the nomenclature file <emphasis>.hie</emphasis> the graph nodes that have the same name or label. For example, if you load several sulci graphs that have been labelled with the same reference nomenclature (eg. the file <emphasis>sucal_root_colors.hie</emphasis>), you can do a hierarchical selection with the nomenclature (display of the selected node and its sub-nodes for all labelled sulci graphs). It is also possible in a nomenclature to associate a color to <emphasis role="bold">name</emphasis> and <emphasis role="bold">label</emphasis> graph attributes. A classical example is to use a nomenclature to visualize sulci labelling (each recognized sulcus is named and the graph is associated to a nomenclature that links each label to a specific color).</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </sect1>
      <sect1><title>Loading an object</title>
        <para>There are several ways to load an object in Anatomist : 
          <itemizedlist>
            <listitem><para>Click on menu <emphasis>File =&gt; Open</emphasis> and then choose the file to load with the file browser.</para></listitem>
            <listitem><para>Click on Open button in the main window.</para></listitem>
            <listitem><para>Drag and drop a file in Anatomist from a file explorer or from brainvisa database browser.</para></listitem>
          </itemizedlist>
        </para>
        <para>The loaded files appear in Anatomist main window's left panel.</para>
        <para>NOTE : it is also possible to drag and drop an object from Anatomist to a console or a file explorer in order to copy the file or the filename. </para>
      </sect1>
      
      <sect1>
        <title>Objects attributes</title>
        <para>Most objects are described by common attributes that give information about them. For example, a volume has attributes for voxels size, image size... Each object can also have specific attributes. To see these attributes, you can put the object in a browser &window-browser-small;.
	<!-- Vous pouvez consulter en annexe les attributs de quelques
	objets comme les formats <link linkend="ana_man%a_fGIS">GIS</link>, <link linkend="ana_man%a_fDICOM">DICOM</link>, ou <link linkend="ana_man%a_fANALYZE">les graphes</link>.-->
	</para>
        <para>NOTE : Putting an object in a browser doesn't always enable to see its attributes, it depends on the type of the object. Indeed, a browser also enable to see structure of complex objects, like graph nodes.</para>
      </sect1>
      <sect1>
        <title>Objects visualization</title>
          <para>There are several ways of visualizing an object in a window<!--faire un lien--> (after object loading) : </para>
          <itemizedlist>
            <listitem><para>Drag and drop the object on a window icon of the left menu bar (it will open a new window containing this object).</para></listitem>
	    <listitem><para>Drag and drop the object on an already opened window.</para></listitem>
	    <listitem><para>Drag and drop the object on an opened window icon in the right panel.</para></listitem>
            <listitem><para>Select the object and a window and click on <emphasis>add</emphasis> button in the left menu bar.</para></listitem>
            <listitem><para>Select the object and a window and click on <emphasis>Objects => Add objects in windows</emphasis> menu.</para></listitem>
          </itemizedlist>
          <para/>
          <para>Likewise, there are several ways to remove an object from a window :</para>
          <itemizedlist>
            <listitem><para>Select the object and the window and click on <emphasis>Remove</emphasis> button in the left menu bar.</para></listitem>
            <listitem><para>Select the object and the window and click on <emphasis>Objects => Remove objects from windows</emphasis>menu.</para></listitem>
          </itemizedlist>
        <para>It is also possible to <emphasis role="bold">copy all objects from a window to another window</emphasis> : drag and drop the source window on the destination window. This will open all visible objects of the source window in the destination window.
        </para>
        </sect1>
      <sect1><title>Objects menu</title>
        Some actions on objects are available through a right click menu. These actions depend on the type of object. Some actions are added by Anatomist plugins and may not be available in all configurations (it depends on the plugin dependencies).
        <itemizedlist>
          <listitem>File: enables to reload, save and rename an object.</listitem>
          <listitem>Color: enables to change the object color. Sub menus can be : palette, material and texture. See <xref linkend="ana_man%object_colors"/></listitem>
          <listitem>Referential: enables to change the object referential. See <xref linkend="ana_man%referentiel"/></listitem>
        </itemizedlist>
        For volumes:
        <itemizedlist>
          <!--listitem>Perfusion</listitem-->
          <listitem>ROI: create an associated ROI graph. See <xref linkend="ana_man%roi_toolbox"/> to read how to draw Regions of Interest.</listitem>
          <listitem>Volume rendering: use transparency to render the whole volume in a 3D window. Different tissues (or grey levels) may be assigned different opacities and colors to make them appear in 3D or disapear.</listitem>
        </itemizedlist>
        For meshes:
        <itemizedlist>
          <listitem>Geometry</listitem>
          <listitem>Landmarks</listitem>
        </itemizedlist>
        For graphs:
        <itemizedlist>
          <listitem>Display: enables to display all nodes or edges.</listitem>
          <listitem>Labelling</listitem>
          <listitem>Landmarks</listitem>
          <listitem>ROI</listitem>
        </itemizedlist>

        <sect2 id='ana_man%object_colors' moreinfo='couleur des objets'>
          <title>Objects color</title>
          <para>Colors can be changed for several objects types, including: volume, texture, mesh, bucket and graph nodes. According to the object type, colors are changed by different methods:
          <itemizedlist>
              <listitem>
                <para>Mesh: <emphasis>Material</emphasis> modification.</para>
              </listitem>
              <listitem>
                <para>Texture: <emphasis>Texturing</emphasis> and <emphasis>Palette</emphasis> modification.</para>
              </listitem>
              <listitem>
                <para>Volume: <emphasis>Palette</emphasis>, <emphasis>Texturing</emphasis> and <emphasis>Material</emphasis> modification.
                  <emphasis>Palette</emphasis> is the most commonly used. But a volume is also considered as a geometric object (a mesh representing a rectangle) with values (texture) associated to each point. So by extension, volumes have acces to mesh  (<emphasis>Material</emphasis>) and texture (<emphasis>Texturing</emphasis>) menus.</para>
              </listitem>
              <listitem>
                <para>Textured object (obtained by mesh and texture fusion): <emphasis>Texturing</emphasis> modification.</para>
              </listitem>
            </itemizedlist>
          </para>
          <sect3>
            <title><emphasis>Palette</emphasis> sub-menu
            </title>
            <para>The palette allows to change the color aspect of the texture part of objects. Choose <emphasis>Color => Palette</emphasis> in <emphasis>Object-specific</emphasis> menu or by right-click on the object
            </para>
            <para>
              In medical imaging, we generally use 3D (or 4D) volumes of scalar values: each voxel represents a scalar value (or a grey level). Grey levels may be associated to colors via a palette. A palette is a table that associates colors to voxels values. Anatomist palettes can be modified using the values <emphasis>min</emphasis> (minimum value for the voxels of the volume) and <emphasis>max</emphasis> (maximum value for the voxels of the volume). Changing these boundaries modifies the field of voxels values where the palette applies. So one may "zoom" on a part of the histogram. The same applies to scalar textures mapped on a mesh.
            </para>
            <para>The min and max boundaries of the palette can also be changed directly in the visualization window without opening the palette menu. The following keyboard shortcuts can be used to do so:
              <itemizedlist>
              <listitem>CTRL key + Right clic button and move the mouse up and down: changes the max boundary</listitem>
              <listitem>CTRL key + Right clic button and move the mouse left and right: changes the min boundary</listitem>
            </itemizedlist>
            </para>
            <para>A number of palettes are available and any user can add his own personal palettes.</para>
            <para>NOTE : The default palette for a volume is <emphasis>B-W LINEAR</emphasis>, and <emphasis>Min</emphasis> and <emphasis>Max</emphasis> bounds are set so that they contain 99% of histogram values.
            <!-- Sometimes volumes can appear with a 'white translucent film' effect, du to palette bounds incorrect values. To correct this effect, you can modify <emphasis>Min</emphasis> and <emphasis>Max</emphasis> bounds values. -->
            The default palette for a mesh texture is a <emphasis>Blue-Red</emphasis> gradient.
            </para>
            <para>RGB and RGBA volumes do not have any palette yet.
            </para>
            <para>Some textures are 2D: each mesh vertex has 2 different texture values, which may be interpreted as a 2D coordinate on a palette image. For this it is possible to use a 2D image as a palette, or to mix two 1D palettes.
            </para>
            
            <figure><title>Palette window</title>
              <mediaobject>
                <imageobject role="fop"><imagedata fileref="&DIR_IMG;window_palette.png" format="PNG"  width="500"/></imageobject>
                <imageobject role="html"><imagedata fileref="&DIR_IMG;window_palette.png" format="PNG"/></imageobject>
              </mediaobject>
            </figure>
            
            <table>
              <title>Palette parameters</title>
              <tgroup align="justify" cols="2">
                <thead>
                  <row>
                    <entry>Champ</entry>
                    <entry>Description</entry>
                  </row>
                </thead>
                <tbody>
                  <row>
                    <entry>Available palettes</entry>
                    <entry>List of available palettes. You can <link linkend="ana_man%a_add_palette">add your own palettes</link>. </entry>
                  </row>
                  <row>
                    <entry>Update mode</entry>
                    <entry>Display update : to have a real time update, check the box <emphasis>Responsive</emphasis>. Else uncheck it and click on the button <emphasis>Update</emphasis> to update display. </entry>
                  </row>
                  <row>
                    <entry>Dimension</entry>
                    <entry>
                      <para>
                      <emphasis>1D</emphasis> : the palette is considered as a line : a value of voxel is associated to a point (x) of the palette. </para>
                    <para>
                      <emphasis>2D</emphasis> : the palette is considered as a 2D image : a value of voxel is associated to a point (x, y) of the palette. You can choose a 2D palette in the list of palettes (eg : blue-red-black-dark) or composed one  from two 1D palettes.
                    </para></entry>
                  </row>
                  <row>
                    <entry>Min</entry>
                    <entry>Associates the first color of the palette to a voxel or texture value: any voxel which has a value inferior to this value will be associated to the first color of the palette. </entry>
                  </row>
                  <row>
                    <entry>Max</entry>
                    <entry>Associates the first color of the palette to a voxel or texture value: any voxel which has a value superior to this value will be associated to the last color of the palette. </entry>
                  </row>
                  <row>
                    <entry>Bounds</entry>
                    <entry>These are the min and max values of the graphical min/max sliders just above.</entry>
                  </row>
                  <row>
                    <entry>Reset values</entry>
                    <entry>Sets automatically computed values for min and max (take into account 99% of the histogram values).</entry>
                  </row>
                  <row>
                    <entry>Reset bounds</entry>
                    <entry>Reset the bounds : min = minimum value of the volume voxels and max = maximum value of the volume voxels.</entry>
                  </row>
                  <row>
                    <entry>Palette view</entry>
                    <entry>View of the palette according to the choosen min, max and bounds. It represents the colors distribution on the object. </entry>
                  </row>
                  <row>
                    <entry>Use a second palette for 2D</entry>
                    <entry>Check it if you want to compose a 2D palette from two 1D palettes (only useful for 2D textures). </entry>
                  </row>
                  <row>
                    <entry>Second palette</entry>
                    <entry>List of available palettes. </entry>
                  </row>
                  <row>
                    <entry>Palettes mixing method</entry>
                    <entry>Choose the palettes mixing method <link linkend="ana_man%glos_geometric_fusion">geometric</link> fusion or <link linkend="ana_man%glos_linear_fusion">linear</link>.</entry>
                  </row>
                  <row>
                    <entry>Palette 1D mapping : FirstLine or Diagonal</entry>
                    <entry>If the palette has actually 2 dimensions, that is to say it contains 2 or more lines, but the object texture has only one dimenstion, this option is the way of extracting information form this palette.
                      <para>
                        <emphasis>FirstLine</emphasis> : Keep only the first line of the 2D palette.</para>
                      <para>
                        <emphasis>Diagonal</emphasis> : Take values along the diagonal of the 2D palette.
                      </para>  
                    </entry>
                  </row>
                  <row>
                    <entry>Mixing factor</entry>
                    <entry>Enables to change linear combination between the two palettes if you choosed the linear fusion mode.</entry>
                  </row>

                </tbody>
              </tgroup>
            </table>
          </sect3>
          <sect3><title>Set distinct palette sub-menu</title>
            <para>When using this menu, Anatomist tries to set an appropriate palette to the object according to its content and to the other loaded objects. For example, Anatomist will choose a one-color palette for a binary image, and a palette with colors distinct from other objects palettes to enable easy combinations of objects.</para>
          </sect3>
          <sect3><title>Show/Hide palette sub-menu</title>
            <para>This menu enables to display the object's palette near the window which contains it. When clicking again on the menu, the palette is hidden.</para>
          </sect3>
          <sect3><title><emphasis>Gradient palette</emphasis> sub-menu</title>
            <para>The palette menu only permits to select an already defined palette and to change its bounds. This new menu enables to create your own palette. The gradient palette edition window show the palette as gradients on RGB + opacity channels. For each channel, you can change the curve. By default each channel function is linear and the result is a gray gradation palette.
            </para>
            <para>It is possible to save the palettes created with this tools. If you save the palette as described <link linkend="ana_man%a_add_palette">here</link>, the palette will appear in Anatomist's list of palettes the next time you will start it.</para>
          </sect3>
          <sect3>
            <title><emphasis>Material</emphasis> sub-menu
            </title>
            <para>This menu applies to mesh part of objects. Choose <emphasis>Color => Material</emphasis> in 
              <emphasis>Objet-specific</emphasis> menu or by right-clicking on the object.</para>
            <table>
              <title>Material</title>
              <tgroup align="justify" cols="2">
                <thead>
                  <row>
                    <entry> Option</entry>
                    <entry> Description</entry>
                  </row>
                </thead>
                <tbody>
                  <row>
                    <entry><para> Quick selection</para></entry>
                    <entry><para> Adjustment of the color (or light) and opacity in each point of the mesh .</para></entry>
                  </row>
                  <row>
                    <entry><para> Advanced adjustments : Ambient</para></entry>
                    <entry><para> Ambient light adjustment.</para></entry>
                  </row>
                  <row>
                    <entry><para> Advanced adjustments : Diffuse</para></entry>
                    <entry><para> Same as <emphasis>Quick selection</emphasis> panel.</para></entry>
                  </row>
                  <row>
                    <entry><para> Advanced adjustments : Emission</para></entry>
                    <entry><para> Adjustment of the light emitted by the object.</para></entry>
                  </row>
                  <row>
                    <entry><para> Advanced adjustments : Specular</para></entry>
                    <entry><para> Adjustment of the reflection light seen in front of the object.</para></entry>
                  </row>
                  <row>
                    <entry><para> Advanced adjustments : Reflection extent</para></entry>
                    <entry><para> Inverse of the reflection extent. If the cursor is set to the maximum, it shows a &quot;plastic&quot; effect, otherwise if the cursor is set to the minimum, it appears more &quot;metallic&quot;.</para>
                    </entry>
                  </row>
                  <row>
                    <entry><para> Advanced adjustments : Update mode</para></entry>
                    <entry><para> Enable/disable automatic update.</para></entry>
                  </row>
                </tbody>
              </tgroup>
            </table>
          </sect3>
          <sect3>
            <title>Texturing</title>
            <!-- texturing geo modifier le materiau pour voir 1 effet -->
            <para>This menu applies to the texture part of objects. Choose <emphasis>Color => Texturing</emphasis> in <emphasis>Object-specific</emphasis> menu or by right-click on the object.</para>
            <table>
              <title>Mapping Mode</title>
              <tgroup align="justify" cols="2">
                <thead>
                  <row>
                    <entry> Option</entry>
                    <entry> Description</entry>
                  </row>
                </thead>
                <tbody>
                  <row>
                    <entry>
                      <para> Geometric</para>
                    </entry>
                    <entry>
                      <para> RGB channels multiplication (between texture and mesh). White color is the 'neutral element'.
                        <!-- Modification du materiau --> </para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para> Linear</para>
                    </entry>
                    <entry>
                      <para> RGB channels addition weighted by a coefficient.<!-- Pas de modification du materiau.--></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para> Replacment</para>
                    </entry>
                    <entry>
                      <para>Only the texture is used and it replaces the mesh color (or previous texture when there are multiple textures).</para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para> Decal</para>
                    </entry>
                    <entry>
                      <para>
                        <!--Addition des canaux RGB ponderee par un coefficient.-->
                      </para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para> Blend</para>
                    </entry>
                    <entry>
                      <para/>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para> Add</para>
                    </entry>
                    <entry>
                      <para> RGB channels addition.</para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para> Combine</para>
                    </entry>
                    <entry>
                      <para/>
                    </entry>
                  </row>
                </tbody>
              </tgroup>
            </table>
            <table>
              <title>Texture generation (rarely used option - this generates new texture coordinates on-the-fly)</title>
              <tgroup align="justify" cols="2">
                <thead>
                  <row>
                    <entry> Option</entry>
                    <entry> Description</entry>
                  </row>
                </thead>
                <tbody>
                  <row>
                    <entry>
                      <para> None</para>
                    </entry>
                    <entry>
                      <para> No texture generation applied.</para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para> Linear-object</para>
                    </entry>
                    <entry>
                      <para> The texture is fixed in relation to the object.</para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para> Linerar-eye</para>
                    </entry>
                    <entry>
                      <para> The texture is fixed in relation to observer's eye.</para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para> Sphere reflection</para>
                    </entry>
                    <entry>
                      <para> The texture is reflected around the object.</para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para> Reflection</para>
                    </entry>
                    <entry>
                      <para> The texture is side reflected.</para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para> Normal</para>
                    </entry>
                    <entry>
                      <para> The texture is reflected in relation to the object's normal.
                        <!-- sur 1 plan mm couleur -->
                      </para>
                    </entry>
                  </row>
                </tbody>
              </tgroup>
            </table>
            <table>
              <title>Options</title>
              <tgroup align="justify" cols="2">
                <thead>
                  <row>
                    <entry> Option</entry>
                    <entry> Description</entry>
                  </row>
                </thead>
                <tbody>
                  <row>
                    <entry>
                      <para> Mixing rate</para>
                    </entry>
                    <entry>
                      <para> Mixing rate for the <emphasis>Mapping mode</emphasis>
                      </para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para> Texture filtering</para>
                    </entry>
                    <entry>
                      <para> Enable/disable filtering.</para>
                    </entry>
                  </row>
                </tbody>
              </tgroup>
            </table>
          </sect3>
      </sect2>
      </sect1>

    </chapter>
    
    <chapter><title>Controls</title>
      <sect1 id="ana_man%d_ctr" infoid="section/controls definition">
        <title>What is a control ?</title>
        <para>A control defines the way mouse and keyboard act on a window or an object. It can also be associated to a toolbox (regions of interest drawing for example). According to the type of objects contained in the window, some action modes can be disabled. For example, the selection mode has no effect on a volume because there are no areas to select on a volume. But you can select areas in a ROI graph (graph nodes).</para>
        <para>Note : some controls are available only on <emphasis>selected</emphasis> objects. You can select objects in a window via the right click menu <emphasis>view / select objects</emphasis>.</para>
        
      </sect1>
      <sect1 id="ana_man%d_ctr_def" infoid="default control description">
        <title>Default control</title>
        <para>
          <emphasis>Icon</emphasis> : &fb_trackball;
        </para>
        <para>
          <emphasis>Description</emphasis> : Default control enables to use the linked cursor, to zoom in, to rotate...</para>
        <figure><title><emphasis>Default control</emphasis> keyboard shortcuts</title>
          <mediaobject>
            <imageobject role="fop"><imagedata fileref="&DIR_IMG;fb_mtrackball.png" format="PNG"  width="180"/></imageobject>
            <imageobject role="html"><imagedata fileref="&DIR_IMG;fb_mtrackball.png" format="PNG"/></imageobject>
          </mediaobject>
        </figure>	
        
      </sect1>
      <sect1>
        <title>Selection control</title>
        <para>
          <emphasis>Icon</emphasis> : &fb_select;
        </para>
        <para>
          <emphasis>Description</emphasis> : Select graph nodes, rotate... </para>
        <figure><title><emphasis>Selection control</emphasis> keyboard shortcuts</title>
          <mediaobject>
            <imageobject role="fop"><imagedata fileref="&DIR_IMG;fb_mselect.png" format="PNG"  width="180"/></imageobject>
            <imageobject role="html"><imagedata fileref="&DIR_IMG;fb_mselect.png" format="PNG"/></imageobject>
          </mediaobject>
        </figure>		  
        
      </sect1>
      <sect1>
        <title>Oblique view control</title>
        <para>
          <emphasis>Icon</emphasis> : &fb_oblique;
        </para>
        <para>
          <emphasis>Description</emphasis> : Creates oblique view by rotating the slice plan.</para>
        <figure><title><emphasis>Oblique view control</emphasis> keyboard shortcuts</title>
          <mediaobject>
            <imageobject role="fop"><imagedata fileref="&DIR_IMG;fb_moblique.png" format="PNG"  width="180"/></imageobject>
            <imageobject role="html"><imagedata fileref="&DIR_IMG;fb_moblique.png" format="PNG"/></imageobject>
          </mediaobject>
        </figure>		  
      </sect1>
      <sect1>
        <title>Flight simulator control</title>
        <para>
          <emphasis>Icon</emphasis> : &fb_flight;
        </para>
        <para>
          <emphasis>Description</emphasis> : Available in expert mode only. It enables to change the point of vue with the keyboard.</para>
        <figure><title><emphasis>Flight simulator control</emphasis> keyboard shortcut.</title>
          <mediaobject>
            <imageobject role="fop"><imagedata fileref="&DIR_IMG;fb_mflight.png" format="PNG"  width="180"/></imageobject>
            <imageobject role="html"><imagedata fileref="&DIR_IMG;fb_mflight.png" format="PNG"/></imageobject>
          </mediaobject>
        </figure>		  
        
      </sect1>
      <sect1 id="ana_man%d_ctr_transformation" infoid="transformation control description">
        <title>Transformation control</title>
        <para>
          <emphasis>Icon</emphasis> : &fb_control_transfo;
        </para>
        <para>
          <emphasis>Description : </emphasis>Enables to move an object in a view in order to make manual registration. It can be useful to initialize a registration method with translation parameters. You can get theses parameters in the .trm file obtained from this registration. See the part <link linkend="ana_man%manual_registration">manual registration</link> for more details. 
        </para>
        <figure><title><emphasis>Transformation control</emphasis> keyboard shortcuts</title>
          <mediaobject>
            <imageobject role="fop"><imagedata fileref="&DIR_IMG;fb_mcontrol_transfo.png" format="PNG"  width="260"/></imageobject>
            <imageobject role="html"><imagedata fileref="&DIR_IMG;fb_mcontrol_transfo.png" format="PNG"/></imageobject>
          </mediaobject>
        </figure>		 	
      </sect1>
      <sect1>
        <title>Region of interest drawing toolbox</title>
        <para>
          <emphasis>Icon</emphasis> : &fb_roi;
        </para>
        <para>
          <emphasis>Description</emphasis> : Opens the region of interest drawing toolbox. See the part <link linkend="ana_man%roi_toolbox">ROI drawing toolbox</link> for more details.</para>
      </sect1>
      <sect1>
        <title>Hand-drawing of Regions of Interest (ROI)</title>
        <para>
          <emphasis>Icon</emphasis> : &fb_draw;
        </para>
        <figure><title><emphasis>ROI drawing control</emphasis> keyboard shortcut</title>
          <mediaobject>
            <imageobject role="fop"><imagedata fileref="&DIR_IMG;fb_mdraw.png" format="PNG"  width="260"/></imageobject>
            <imageobject role="html"><imagedata fileref="&DIR_IMG;fb_mdraw.png" format="PNG"/></imageobject>
          </mediaobject>
        </figure>		  
      </sect1>
      <sect1>
        <title>Threshold ROI drawing mode under connectivity to clicked point constraint</title>
        <para>
          <emphasis>Icon</emphasis> : &fb_level;
        </para>
        <para>
          <emphasis>Description</emphasis> : Opens the ROI toolbox. Use the Connectivity threshold tab to define min and max bounds for the voxels to select. </para>
        <figure><title><emphasis>Threshold ROI drawing keyboard shortcuts</emphasis></title>
          <mediaobject>
            <imageobject role="fop"><imagedata fileref="&DIR_IMG;fb_mlevel.png" format="PNG"  width="500"/></imageobject>
            <imageobject role="html"><imagedata fileref="&DIR_IMG;fb_mlevel.png" format="PNG"/></imageobject>
          </mediaobject>
        </figure>	  	
      </sect1>
      <sect1>
        <title>ROI design by discriminating analysis</title>
        <para>
          <emphasis>Icon</emphasis> : &fb_dynsegment;
        </para>
        <para>
          <emphasis>Description</emphasis> : Opens the ROI toolbox. Use the DynSegment tab to fix parameters. This is usable on dynamic data only.</para>
        <figure><title><emphasis>ROI design by discriminating analysis</emphasis> keyboard shortcuts</title>
          <mediaobject>
            <imageobject role="fop"><imagedata fileref="&DIR_IMG;fb_mdynsegment.png" format="PNG"  width="300"/></imageobject>
            <imageobject role="html"><imagedata fileref="&DIR_IMG;fb_mdynsegment.png" format="PNG"/></imageobject>
          </mediaobject>
        </figure>	  	 	
      </sect1>
      <sect1>
        <title>ROI drawing mode by label selection</title>
        <para>
          <emphasis>Icon</emphasis> : &fb_name;
        </para>
        <para><emphasis>Description</emphasis> : selects region according to their labels. </para>
        <figure><title><emphasis>ROI drawing mode by label selection</emphasis> keyboard shortcuts</title>
          <mediaobject>
            <imageobject role="fop"><imagedata fileref="&DIR_IMG;fb_mname.png" format="PNG"  width="260"/></imageobject>
            <imageobject role="html"><imagedata fileref="&DIR_IMG;fb_mname.png" format="PNG"/></imageobject>
          </mediaobject>
        </figure>	  
      </sect1>
      <sect1 id="ana_man%d_ctr_meshcutting" infoid="mesh cutting control description">
        <title>Mesh cutting control</title>
        <para>
          <emphasis>Icon</emphasis> : &control-cut;
        </para>
        <para><emphasis>Description</emphasis> : available only if a cut mesh is selected ( cut mesh is obtained by fusion between a mesh and a volume ). It controls the slice on a cut mesh.</para>
        <figure><title><emphasis>Mesh cutting control</emphasis> keyborad shortcut</title>
          <mediaobject>
            <imageobject role="fop"><imagedata fileref="&DIR_IMG;mcontrol-cut.png" format="PNG"  width="200"/></imageobject>
            <imageobject role="html"><imagedata fileref="&DIR_IMG;mcontrol-cut.png" format="PNG"/></imageobject>
          </mediaobject>
        </figure>	  
      </sect1>
      
    </chapter>
   
    <chapter><title>Combining objects</title>
        	<sect1><title>Objects superimposing</title>
	
	<sect2><title>General definition</title>
      	<para>Objects superimposing consists in placing several objects in the same window. For example, you can superimpose hemispheres meshes or regions of interest with the matching anatomy (cf. examples below). So there is no specific menu to do that but you can change objects color to have a better display. For example, you can modify transparency, or lights on a mesh.</para>
	<para>Be careful, superimposed objects must be in coherent referentials in order to get informative display. This means that if superimposed objects don't come from the same object (like hemispheres meshes that comes from a T1 MRI) or if they are non equivalent volumes (different subject, modality, point of view, voxels resolution...), you'll probably have to load trnasformations between referentials in order to put all objects in the same coordinates system.</para>
	</sect2>

		    	<sect2><title>Application : Superimposing an anatomy and regions of interest (grey central nuclei)</title>
			<para>In next example, 3 objects are loaded in Anatomist :</para>
			<itemizedlist>
			<listitem><para>Object1 (O1) : anatomy</para></listitem>
      			<listitem><para>Object2 (O2) : regions of interest graph drawn from the anatomy. So these 2 objects are in the same referential.</para></listitem>
			<listitem><para>Object3 (O3) : nomenclature to associate colors to regions of interest according to their name. This   object doesn't have to be put in a window. Link between names in the nomenclature and in regions of interest is done automatically by Anatomist.</para></listitem>
			</itemizedlist>
			<para>These 2 objects are in the same coordinates system, so they will be placed in the same referential, that is to say they will have the same color circle (red by default).<!-- Il y a un troisieme
			objet, une nomenclature decrivant la nomenclature des couleurs mais il ne rentre pas dans le cadre de la superposition.-->
          		</para>
				
                        <figure><title>Superimposing an anatomy and regions of interest</title>
           		<mediaobject>
             		<imageobject role="fop"><imagedata fileref="&DIR_IMG;superpo1.png" format="PNG"  width="260"/></imageobject>
	     		<imageobject role="html"><imagedata fileref="&DIR_IMG;superpo1.png" format="PNG"/></imageobject>
	   		</mediaobject>
			</figure>	
			
			</sect2>

		    	<sect2><title>Application : Superimposing hemispheres meshes and head mesh</title>
			<para>In next example, 3 objects are loaded in Anatomist :
			<itemizedlist>
			<listitem><para>Object1 (O1) : head mesh, object obtained from a T1 MRI with BrainVISA anatomical pipeline.
			 Opacity is decreased in the example below to enable visualization of the other objects.</para></listitem>
      			<listitem><para>Object2 (O2) : right hemisphere mesh, object obtained from the T1 MRI with BrainVISA anatomical pipeline.  </para></listitem>
                        <listitem><para>Object3 (O3) : left hemisphere mesh, maillage de l'hemisphre gauche, object obtained from the T1 MRI with BrainVISA anatomical pipeline. </para></listitem>
			</itemizedlist>
                        These three objects are in the same coordinates system, so they will be placed in the same referential, that is to say they will have the same color circle (red by default).
          		</para>
			
                        <figure><title>Superimposing hemispheres meshes and head mesh</title>
           		<mediaobject>
             		<imageobject role="fop"><imagedata fileref="&DIR_IMG;superpo2.png" format="PNG"  width="300"/></imageobject>
	     		<imageobject role="html"><imagedata fileref="&DIR_IMG;superpo2.png" format="PNG"/></imageobject>
	   		</mediaobject>
			</figure>			

			</sect2>

	</sect1>
    
	<sect1 id='ana_man%object_fusion' moreinfo='fusion d objet'><title>Objects fusion</title>
	
	<sect2><title>General definition</title>
	<para>Objects fusion enables to create a new object from 2 or more other objects. Indeed, if you only put two volumes in the same window, you will see only one. To see the two volumes, you need to mix voxels from the two volumes in order to obtain a new volume. Note that fusionning more than 2 objects is only possible since 1.30 version. Besides, several new features have been added for fusion management. Several fusion combinations between objects are available,but for the moment, let's see a fusion between two 3D volumes for example :
	
	<itemizedlist spacing="compact">
	<listitem><para><emphasis role='bold'>STEP 1 :</emphasis> Load the images to merge. Here, we will fusion an anatomy and the brain mask obtained from BrainVISA anatomical pipeline. </para></listitem>
      <listitem><para><emphasis role='bold'>STEP 2 :</emphasis> Select the two volumes in objects list with <emphasis role="bold">Ctrl + bouton gauche</emphasis>.</para></listitem>
    <listitem><para><emphasis role='bold'>STEP 3 :</emphasis> Then click on fusion button  &fusion;.</para></listitem>
    <listitem><para><emphasis role='bold'>STEP 4 :</emphasis> A new window pop up to select objects order and fusion type (fusion types offered differs according to selected objects, this will be detailled later, in advanced part of the manual).
	 
	<figure><title>Fusion type</title>
	<mediaobject>
	<imageobject role="fop"><imagedata fileref="&DIR_IMG;fusion1.png" format="PNG"  width="195"/></imageobject>
	<imageobject role="html"><imagedata fileref="&DIR_IMG;fusion1.png" format="PNG"/></imageobject>
	</mediaobject>
	</figure>
			
	</para></listitem>
	
      <listitem><para><emphasis role='bold'>STEP 5 :</emphasis> Click on <emphasis role="bold">Ok</emphasis> to create the new <emphasis role="bold">Fusion2D</emphasis> object.</para></listitem>
    <listitem><para><emphasis role='bold'>STEP 6 :</emphasis> Put the <emphasis role="bold">Fusion2D</emphasis> object in a window.</para></listitem>
    <listitem><para><emphasis role='bold'>STEP 7 :</emphasis> If the <emphasis role="bold">Fusion2D</emphasis> object is all in black, you must change fusion mode. So right click on <emphasis role="bold">Fusion2D</emphasis> object to get its menu. Choose <emphasis role="bold">Fusion => Control 2D fusion</emphasis>. This window opens : 
		
	<figure><title>Fusion control</title>
	<mediaobject>
	<imageobject role="fop"><imagedata fileref="&DIR_IMG;fusion2.png" format="PNG"  width="305"/></imageobject>
	<imageobject role="html"><imagedata fileref="&DIR_IMG;fusion2.png" format="PNG"/></imageobject>
	</mediaobject>
	</figure>
			
	</para></listitem>
      <listitem><para><emphasis role='bold'>STEP 8 :</emphasis> You can change the mapping mode. The default is <emphasis role="bold">Linear</emphasis> : it does a linear combination of the two volumes. The <emphasis role="bold">Geometric</emphasis> mode does RGB channels multiplication. For linear fusions, you can set objects transparency with the cursor <emphasis role="bold">Mixing rate</emphasis>.</para></listitem>
      <listitem><para><emphasis role='bold'>STEP 9 :</emphasis> By default, the 2 volumes will have the same palette. To change at least one, do <emphasis role="bold">Right clik menu on a volume => Color => Palette</emphasis>.</para></listitem>
        </itemizedlist>
	</para>
        
        <figure><title>Example of a linear fusion between two 3D volumes</title>
          <mediaobject>
            <imageobject role="fop"><imagedata fileref="&DIR_IMG;fusion_volumes.png" format="PNG"  width="500"/></imageobject>
            <imageobject role="html"><imagedata fileref="&DIR_IMG;fusion_volumes.png" format="PNG"/></imageobject>
          </mediaobject>
        </figure>
	
	<para>NOTE : Since the last version of Anatomist, it is possible to create multi-fusion, that is to say fusionning more than 2 objects. For volumes, here is the method : with for example 3 volumes (V1, V2 and V3), Anatomist 	actually fusion the last volume and the volume above in the list (V2 and V3 gives V23). Then, from this fusion object, it creates a new fusion with the volume above (V23 and V1 gives V23_1). To set parameters for each fusion, you have to select the fusion's second volume. For example, to set parameters for fusion V23_1, you must select V2.</para>
	
        <para>NOTE : In this example, we didn't have to matter about objects referential management because the brain mask (brain_lesson1.ima) have been generated from the anatomy, so objects are in the same referential. But if we had done a fusion between an anatomical volume and an activation map (which is in another referential since this map comes from a functional volume), we would have to handle referentials to put the objects in a coherent coordinates system. 
	</para>
	</sect2>
        
	<sect2>
          <title>Type of fusions</title>
            <para>The following table show which type of fusion is available according to the type of objects :
              
              <table><title>Fusion descriptions</title><tgroup align="justify" cols="3"> <thead>
                    <row><entry>Objects</entry><entry>Fusion name</entry><entry>Description</entry></row></thead> <tbody> 
                    <row><entry><para>Only one image</para><mediaobject><imageobject role="fop"><imagedata fileref="&DIR_IMG;fusion_slice_method_little.png" format="PNG"  width="20"/></imageobject> <imageobject role="html"><imagedata fileref="&DIR_IMG;fusion_slice_method_little.png" format="PNG"/></imageobject></mediaobject> </entry>
                      <entry>FusionSliceMethod</entry> <entry><para>Fusion allowing to cut a volume across itself: to view/intersect 2 different slices of the same volume in the same window. 	</para> </entry></row> 
                    
                    <row><entry><para>2 or many images <mediaobject><imageobject role="fop"><imagedata fileref="&DIR_IMG;fusion_map_anat_little.png" format="PNG"  width="20"/></imageobject> <imageobject role="html"><imagedata fileref="&DIR_IMG;fusion_map_anat_little.png" format="PNG"/></imageobject></mediaobject></para></entry> <entry>Fusion2DMethod</entry> <entry><para>The volumes are merged in one volume. A voxel of the resulting volume is a combination of the same voxel in each original volume. </para></entry></row> 
                    
                    <row><entry><para>Volume + Mesh <mediaobject><imageobject role="fop"><imagedata fileref="&DIR_IMG;fusion_map_iwhitemesh_little.png" format="PNG"  width="20"/></imageobject> <imageobject role="html"><imagedata fileref="&DIR_IMG;fusion_map_iwhitemesh_little.png" format="PNG"/></imageobject></mediaobject> </para></entry><entry>Fusion3DMethod</entry> <entry><para>Maps on the mesh a texture corrsponding to the volume values.</para></entry></row>
                    
                    <row><entry><para>Volume + Mesh</para></entry><entry>FusionCutMeshMethod</entry> <entry><para>Mesh cut by a plane: the cutting plane will have the texture of the volume slice. When you put this object in a 3D window, the "cut mesh" control is available. It enables to control the orientation of the slice (<emphasis>shift</emphasis>) and its position (<emphasis>ctrl</emphasis>) against the mesh. </para></entry> </row>
                    
                    <row><entry><para>2 textures</para></entry><entry>FusionTextureMethod</entry> <entry><para>Creates a 2D texture from two 1D textures.</para></entry></row> 
                    
                    <row><entry><para>2 textures</para></entry><entry>FusionMulitTextureMethod</entry> <entry><para>Multi-texture: allows to map several textures on a mesh.</para></entry></row> 
                    
                    <row><entry><para>Mesh + Mesh</para></entry><entry>SurfaceMatcher</entry> <entry><para>Matching surfaces. This object gives access to a surface deformation algorithm. It tries to transform one surface into the other.</para></entry></row> 
                    <row><entry><para>Mesh + Texture</para></entry><entry>FusionTexSurfMethod</entry><entry><para>Textured surface.</para></entry></row>
                    
                  </tbody></tgroup></table>
            </para>
         
            <sect2><title>Fusion3D parameters</title>   
            The 3D Fusion is a fusion between a volume and a mesh. This fusion can be parameterized through the right click menu on the fusion object.
            <itemizedlist>You can change : 
              <listitem>Fusion mode : Geometrical, linear, rate.</listitem>
              <listitem>Methods of interpolation : the method to estimate the value for the intersection between the mesh and the volum at each point. 
            <table><title>Interpolation methods</title>
              <tgroup align="justify" cols="2">
                <thead><row><entry>Section</entry><entry>Description</entry></row></thead>
                <tbody>
                  
                  <row><entry>Point to point</entry>
                    <entry><para>the simplest: only the information coming from the voxel directly under the mesh vertex is used, directly. Do not use the depth and the step prameters.</para></entry>
                  </row>
                  
                  <row><entry>Point to point with depth offset (inside/outside) </entry>
                    <entry><para>Only one voxel is taken into account, but its position is shifted along the normal to the mesh (either inside the mesh or outside), for each mesh vertex (Do not use &lt;Step&gt;).</para></entry>
                  </row>
                  
                  <row><entry>Line to point </entry>
                    <entry><para>Information is taken along the normal line, both inside and outside, with a sampling (depth and step) specified by appropriate parameters.</para></entry>
                  </row>
                  
                  <row><entry>Inside line to point</entry>
                    <entry><para>The value corresponds to &lt;the_choosen_submethod&gt; value for the interpolation for a inside line localized at &lt;Depth&gt; and for a sampling &lt;Step&gt; </para></entry>
                  </row>
                  
                  <row><entry>Outside line to point </entry>
                    <entry><para>The value corresponds to &lt;the_choosen_submethod&gt; value for the interpolation for a ouside line localized at &lt;Depth&gt; and for a sampling &lt;Step&gt; </para></entry>
                  </row>
                  
                  <row><entry>Sphere to point</entry>
                    <entry><para>A sampling into a sphere (depth and step parameters apply) is used to get locations in the 3D volume</para></entry>
                  </row>
                  
                </tbody></tgroup></table>
          </listitem>
            
          <listitem>Submethods: This only applies to interpolation methods that are not single-voxel (such as point to point methods)
            <table><title>Interpolation sub-methods</title>
              <tgroup align="justify" cols="2">
                <thead><row><entry>Section</entry><entry>Description</entry></row></thead>
                <tbody>
                  <row><entry>Max</entry>
                    <entry><para>The maximum value of all voxels of the volume at the sampled locations is mapped on the mesh</para></entry>
                  </row>
                  
                  <row><entry>Min</entry>
                    <entry><para>The minimun value of all voxels of the volume at the sampled locations is mapped on the mesh</para></entry>
                  </row>
                  
                  <row><entry>Mean</entry>
                    <entry><para>Standard mean (sum of values divided by the number of locations)</para></entry>
                  </row>
                  
                  <row><entry>Corrected mean</entry>
                    <entry><para>Only non-nul values are taken into account in the mean computation: this is more suitable for thresholded activation maps for instance to avoid blurring the mapped values.</para></entry>
                  </row>
                  
                  <row><entry>Enhanced mean</entry>
                    <entry><para>In the enhanced mean variant, a weighting of the final value is applied depending on the proportion of null values in the set of mixed values.</para></entry>
                  </row>
                  
                </tbody></tgroup></table>
          </listitem>
          <listitem>Parameters: definition of localization of another point to do an interpolation
            <table><title>Interpolation parameters</title>
              <tgroup align="justify" cols="2">
                <thead><row><entry>Section</entry><entry>Description</entry></row></thead>
                <tbody>
                  
                  <row><entry>Depth</entry>
                    <entry><para>Position of the other point</para></entry>
                  </row>
                  
                  <row><entry>Step</entry>
                    <entry><para>Sampling step. Always inferior to Depth.</para></entry>
                  </row>
                  
                </tbody></tgroup></table>	
          </listitem>
        </itemizedlist>
      </sect2>
        
            <para>NOTE: be aware that all this is only a visualization toy and is not very robust: no real interpolation of the volume values is performed to get a continuous intersection 
              along the mesh: especially the methods taking points along normals can produce inaccurate results on high curvature regions (produce discontinuities, map the same voxel 
              value on several vertices etc). The sphere mode is more robust but involves an averaging (blurring) effet, and can take values outside the brain or grey matter ...
            </para>
            
        </sect2>
    </sect1> 
  </chapter>
  
    
    <chapter><title>About referentials</title>
    <sect1 id='ana_man%load_and_display_objects' moreinfo='Chargement et affichage des objets'>
      <title>Load and display objects</title>
      <para>Loading and displaying are two different actions in Anatomist. Loading is reading data stored in memory. While displaying is visualizing the object in Anatomist windows, with maybe modifications. For example, you can load data written in radiological convention and display it in neurological convention. The display options doesn't change data on disk.</para>
      <sect2>
        <title>Axis orientation</title>
        <para>Axis in Anatomist  are oriented like this : </para>
        <itemizedlist>
          <listitem>
            <para>X axis : right => left</para>
          </listitem>
          <listitem>
            <para>Y axis : anterior => posterior </para>
          </listitem>
          <listitem>
            <para>Z axis : top => bottom </para>
          </listitem>
          <listitem>
            <para>T axis : 4th dimension to visualize a volume with an adding cursor to move from volume to volume ; This axis can stand for the time in functional volumes vizualisation or directions for a diffusion sequence. </para>
          </listitem>
        </itemizedlist>
      </sect2>
      <sect2>
        <title>Neurological and radiological convention managing</title>

        <sect3><title>Reading volumes on disk</title>	
        <para>When loading a volume, data organisation is supposed to match axis organisation describe before. That is to say data is supposed to be in radiological convention. In this case, data is not modified for displaying in radiological convention. </para>
	
	<para>For volumes in ANALYZE format, reading and displaying data depends on the following properties (attributes in .minf file and .aimsrc configuration file) : </para> 
	
        <itemizedlist>
	<listitem>Attributes <emphasis>spm_normalized</emphasis> and <emphasis>spm_radio_convention</emphasis> in .minf file of the volume (GIS format).</listitem>
	<listitem>.aimsrc configuration file of the user.</listitem>
        <listitem>.aimsrc configuration file of the site.</listitem>
        <listitem>.aimsrc configuration file of the package.</listitem>
	<listitem>By default, SPM2 mode is used.</listitem>
        </itemizedlist>

		
	<para>NOTE : if <emphasis>spm_radio_convention</emphasis> attribute value is 1, data in ANALYZE format is in radiological convention on disk. Else, if <emphasis>spm_radio_convention</emphasis> value is 0, data is in neurological convention.</para>
	<para>NOTE : <link linkend="ana_man%a_aimsrc"><emphasis role="bold">.aimsrc file configuration</emphasis></link></para>
	
	</sect3>

        <sect3 id='ana_man%mSPM99' infoid='mode SPM99'><title>What is SPM99 mode ?</title>	
	<para><emphasis role='bold'>The following explanations are valid only if your site / station is configured as ours according to the flip parameter of SPM99.</emphasis>
	So for us, non normalized volumes are in radiological convention and volumes nomralized by SPM99 are in neurological convention. That's why volumes identified as normalized volumes (according to their size in mm) are automatically flipped, to have a coherent display with data in radiological convention.</para>
	<para>To go on working in SPM99 mode, your .aimsrc file must be configured like this :
        <screen> attributes = {
	'__syntax__' : 'aims_settings',
	'spm_input_radio_convention' : 1,
	'spm_input_spm2_normalization' : 0,
        'spm_output_radio_convention' : 1,
	'spm_output_spm2_normalization' : 0,
	}
        </screen></para>
      <para>Volumes in analyze format are read in radiological convention ('spm_input_radio_convention' : 1) and normalized volumes in neurological convention ('spm_input_spm2_normalization' : 0).</para>
	
	<para><emphasis role='bold'>Reading normalized volumes in SPM99 mode</emphasis></para>	
        <para>As it is said before, in SPM99 mode, Aims tests the volume dimensions to see if it is normlized or not. A volume is considered as a normalized volume if its dimensions in mm are 152 &lt; x &lt; 165, 185 &lt; y &lt; 195, 130 &lt; z &lt; 145 or 178 &lt; x &lt; 185, 215 &lt; y &lt; 220, 178 &lt; z &lt; 185. In this case, the volume is supposed to be in neurological convention and it is automatically flipped at loading to display it in radiological convention.</para>
	</sect3>
	

        <sect3 id='ana_man%mSPM2' infoid='mode SPM2'><title>What is SPM2 mode ?</title>	
	<para>It is different for volumes normalized with SPM2. Indeed, there is a parameter <emphasis>defaults.analyze.flip
        </emphasis> which indicates if input data must be flipped. (for more details, see SPM2 documentation). So data normalized with SPM2 can be either in radiological convention or in neurological convention. The aim is to keep the same convention for input and output data (before and after normalization).</para>
	<para>To work in SPM2 mode (input convention = output convention), your .aimsrc file must be configured like this if your data is in radiological convention :
        <screen> attributes = {
	'__syntax__' : 'aims_settings',
	'spm_input_radio_convention' : 1,
	'spm_input_spm2_normalization' : 1,
        'spm_output_radio_convention' : 1,
	'spm_output_spm2_normalization' : 1,
	}
        </screen></para>
	<para>NOTE : we won't deal with the case where input data is in radio convention and output data (normalized data) in neuro convention.</para>

	</sect3>

        <para>Anatomist needs to manage displaying like this because there isn't reliable information to indicate the convention. Some header attributes have this information but it can be incorrect or out of date. For example, SPM2 doesn't rewrite the header of modified volumes.</para>
		  
      </sect2>
      <sect2>
        <title>Origin of volumes</title>
        <sect3>
          <title>Reading origin</title>
          <para>The origin of volumes is the voxel whose coordinates are (0, 0, 0). This voxel is located forward, on top and on the right of the volume. So, in an axial Anatomist window, this point will be at the top left corner if you keep the radiological display mode. If the origin is in mm, the origin of the volume is the centre of the voxel located at the origin.</para>
        </sect3>
 
      </sect2>
    </sect1>
    <sect1>      <title>Coordinates system</title>
      <sect2>
        <title>Real world sampling : coordinates in mm and in voxels</title>
        <sect3>
          <title>Definition</title>
          <para>When loading any object (volume, mesh, ROI graph...), the real world is sampled. That is to say, the view is sampled according to the image's matrice and the voxels' resolution. So coordinates can be expressed in mm (real world) and in voxels (after sampling).</para>
        </sect3>
        <sect3>
          <title>Mecanism</title>
          <para>When you click on an object in a window, the position of the cursor appears in the console. This position is given in mm and in voxel if the object is a volume. After the position, you find the value of the voxel.</para>
	<para>If the window contains several objects, the coordinates of each objects are displayed.</para>	
	 <figure><title>Coordinates in mm / coordinates in voxel</title>
           <mediaobject>
             <imageobject role="fop"><imagedata fileref="&DIR_IMG;coord_leg.png" format="PNG"  width="490"/></imageobject>
	     <imageobject role="html"><imagedata fileref="&DIR_IMG;coord_leg.png" format="PNG"/></imageobject>
	   </mediaobject>
         </figure>	  	

        </sect3>
        <sect3>
          <title>Coordinates systems</title>
          <para>There are several coordinates systems (referentials) managed by Anatomist more or less automatically. That is to say some transformations can be loaded automatically either via BrainVISA, or by Anatomist. For example, if a volume is identified as a normalized volume (SPM), then the transformation toward SPM referential is loaded. </para>
          <itemizedlist>
            <listitem>
              <para>
                <emphasis role="bold">Object's referential</emphasis> : this is the real world sampled like explained before.</para>
            </listitem>
            <listitem>
              <para>
                <emphasis role="bold">Talairach-AC/PC-Anatomist referential</emphasis> : In BrainVISA anatomical pipeline, an affine transformation  is computed : it is based on AC and PC points indicated by the user on the anatomy.</para>
            </listitem>
            <listitem>
              <para>
                <emphasis role="bold">Talairach-MNI template-SPM referential</emphasis> : Transformation applicated if the volume is normalized. </para>
            </listitem>
          </itemizedlist>
          <para>NOTE : Anatomist always loads a transformation from Talairach-AC/PC-Anatomist referential to Talairach-MNI template-SPM referential.</para>
        </sect3>
      </sect2>
      <sect2><title>Linked cursor position</title>
		<para>The linked cursor position is defined from the origin of the object. You can move the cursor to an exact position by fixing x, y, and z via the window menu : 
		<emphasis role="bold">Scene =&gt; Manually specify linked cursor position. </emphasis>. You can also use the shortcut <emphasis role="bold">Ctrl + P</emphasis>. You specify the coordinates in mm like this : x y z.</para>
		</sect2>

    </sect1>
    
    <sect1 id='ana_man%referentiel' moreinfo='Referentials and transformations'><title>Referentials and transformations in Anatomist</title>

		<sect2><title>General definition</title>
        	<para>A referential stands for a coordinates system and can be allocated to an object. So an object can moved from its referential to another if it exists a transformation between the two referentials. This transformation enables to change the corrdinates. </para>

		<para>A referential can be allocated to an object or to a window. A transformation between two objects enables to align one object with the other. Whereas a transformation between an object and a window  changes the point of view for visualizing the object.</para>

      		</sect2>

		<sect2><title>Transformations' format</title>
          	<para>Anatomist manages affine transformations : translation, rotation, zoom. It uses .trm format, created for Anatomist. It is an ascci file, so it can be opened and modified with any text editor. It contains a 3x3 matrix and a translation vector.</para>
		
	 	<figure><title>Example of a transformation .trm file</title>
           	<mediaobject>
             	<imageobject role="fop"><imagedata fileref="&DIR_IMG;fichier_trm.png" format="PNG"  width="200"/></imageobject>
	     	<imageobject role="html"><imagedata fileref="&DIR_IMG;fichier_trm.png" format="PNG"/></imageobject>
	   	</mediaobject>
         	</figure>		
		
	        <para>This means : </para>
          	<para><emphasis>Tx Ty Tz</emphasis></para>
          	<para><emphasis>Rxx Rxy Rxz</emphasis></para>
          	<para><emphasis>Ryx Ryy Ryz</emphasis></para>
          	<para><emphasis>Rzx Rzy Rzz</emphasis></para>

		<para>This format defines a translation T and a rotation matrix R. Ce format spcifie une translation T et une matrice de rotation R. Let R1 the refenential of a first volume and R2 the referential of a second volume. The file R1_TO_R2 gives a transformation that moves from R1 to R2. So we have the following relation between coordinates of the two referentials : X2 = R *  X1 + T.</para>

                <para>The name of transformation file is generally *TO*.trm where each <emphasis role="bold">*</emphasis> is a referential. For example : refimage_TO_Talairach.trm. These transformations apply between two referentials  and modifies only display of corresponding objects. Data on disk is not modified.</para>

      		</sect2>

 		<sect2><title>Referential of an object</title>
			<sect3><title>Definition</title>
        		<para>Each object has an associated referential. Referentials are useful to compare objects. Without referentials each objects would be in its own coordinates system (sampling of the real world according to volume dimensions and voxels size) and objects coming from different modalities or acquisition wouldn't be comparable. With identified referentials and transformations to move from one to another, it is possible to put objects in the same referentials in order to superimpose or merge them in a consistent way.</para>
			</sect3>

			<sect3><title>Why and how changing the referential of an object ?</title>
			<para><emphasis role="bold">Why : </emphasis></para>
			<itemizedlist>
			<listitem><para>Put an object in a new referential and load a transformation to another object in order to compare the two objects. For example, you have registered an fMRI to a T1 MRI and obtained a transformation file. You can use this transformation to visualize the two original images in a consistent way : put each object in a referential and load the transformation from fMRI referential to T1 MRI referential. </para></listitem>
			<listitem><para>Put a new object (o1) in the referential of another object (o2) which has already a transformation to the referential of a third object. In this case o1 and o2 are supposed to be in the same coordinate system. For example, o1 can be a mesh obtained from the anatomy o2. </para></listitem>
			</itemizedlist>
			<para><emphasis role="bold">How : </emphasis>Click on the object and select 
			<emphasis>Referential => Load</emphasis> And then choose an existing referential or create a new one if needed. </para>
			</sect3>

      		</sect2>

 		<sect2><title>Referential of a window</title>
			<sect3><title>Definition</title>
        		<para>Each window is associated to a referential. This referential is used to visualize objects. If the referential of the window is different from the referential of the containing objects, it can change the point of view if there is a transformation between the two referentials.</para>
			</sect3>

			<sect3><title>Why and how changing the referential of a window ?</title>
			<para><emphasis role="bold">Why </emphasis>: For example to see several anatomical MRI in the same referential, Talairach-AC/PC-Anatomist based on AC and PC points defined in the process <emphasis role="bold">Prepare subject</emphasis> of BrainVISA.</para>
			<para><emphasis role="bold">How : </emphasis></para>
			<itemizedlist><listitem><para>Click on the colored bar indicating the referential. See the figure below :</para>
			
	 		<figure><title>Modifying the referential of a window (1)</title>
           		<mediaobject>
             		<imageobject role="fop"><imagedata fileref="&DIR_IMG;ref_fen1.png" format="PNG"  width="165"/></imageobject>
	     		<imageobject role="html"><imagedata fileref="&DIR_IMG;ref_fen1.png" format="PNG"/></imageobject>
	   		</mediaobject>
			</figure>			
			</listitem>
			<listitem><para>A new window opens and you can create a new referential or choose an existing one :</para>
			
			<figure><title>Modifying the referential of a window (2)</title>
           		<mediaobject>
             		<imageobject role="fop"><imagedata fileref="&DIR_IMG;ref_fen2.png" format="PNG"  width="85"/></imageobject>
	     		<imageobject role="html"><imagedata fileref="&DIR_IMG;ref_fen2.png" format="PNG"/></imageobject>
	   		</mediaobject>
			</figure>
			
			</listitem>
			</itemizedlist>
			</sect3>

      		</sect2>

      		<sect2><title>Loading a transformation between two referentials</title>
        	<para>To load a transformation between two referentials : </para>
		<itemizedlist>
		<listitem><para>Select the menu <emphasis role="bold">Settings => Referential window</emphasis>.</para></listitem>
		<listitem><para>A new window opens showing existing referentials (colored points) and transformations (arrows) between them. To load a new transformation, you need at least 2 referentials.</para></listitem>
		<listitem><para>To load the transformation, draw a line with the mouse from one referential to the other (take care of the direction). Then a file dialog opens and you select the transformation file.</para></listitem>
		<listitem><para>Windows and objects associated to these referentials are updated. </para></listitem>
		</itemizedlist>
      		</sect2>

      		<sect2><title>Actions on transformations : delete, save...</title>
	        <para>The transformation menu is available by right click on the arrow representing the transformation (in the window <emphasis role="bold">Settings =&gt; Referential window</emphasis>). Here is this menu : </para>
		<itemizedlist>
		<listitem><para><emphasis role="bold">Delete transformation</emphasis> : deletes the transformation between the two referentials.</para></listitem>
		<listitem><para><emphasis role="bold">Invert transformation</emphasis> : inverts the direction of the transformation.</para></listitem>
		<listitem><para><emphasis role="bold">Reload transformation</emphasis> : enables to change the transformation information by choosing a .trm file.</para></listitem>
		<listitem><para><emphasis role="bold">Save transformation</emphasis> : saves the transformation in a file. Used in transformation control (manual registration). </para></listitem>
		</itemizedlist>
		</sect2>

      		<sect2><title>Application : loading a transformation (coming from registration) between an anatomical volume and a functional volume. </title>
	        <para>For example, we want to visualize an antomical image (anat.img) and a functional image (fonc.img). We need to align the volumes using a transformation matrix (previously computed anatTOfonc.trm). Each volume has its own coordinates system. </para>
		<!-- Faire un film pour remplacer les images step -->
		<para><emphasis role='bold'>STEP 1 :</emphasis> Load volumes, set a new referential for fonc.img and create a linear fusion between anat.img and fonc.img.
          	</para>

                <para><emphasis role='bold'>STEP 2 :</emphasis> Select the menu <emphasis role="bold">Settings => Referential window</emphasis>.
          	</para>
		
                <para><emphasis role='bold'>STEP 3 :</emphasis> Then you see the referentials window. 
		</para>
		
                <para><emphasis role='bold'>STEP 4 :</emphasis> Draw a line with the mouse from one referential to the other according to the direction of the transformation. A file dialog will open.
          	</para>
		
                <para><emphasis role='bold'>STEP 5 :</emphasis> We can see that there is a now transformation between the two referentials and that the fusion display is updated.
          	</para>
                
                <figure role="fop"><title>Loading a transformation between an anatomical volume and a functional volume.</title>
                <mediaobject>
                  <imageobject role="fop"><imagedata fileref="&DIR_IMG;fusion_map_anat_1.png" format="PNG"  width="200"/></imageobject>
                  <videoobject role="html"><videodata fileref='&DIR_VIDEO;registration.swf' width="900" height="700"/></videoobject>
                </mediaobject>
                </figure>

      		</sect2>

		<sect2><title>How to get a transformation file ? </title>
        	<para>There are several ways to get a .trm file :</para>
		<itemizedlist>
		<listitem><para>Using Aims commands to register 2 volumes (AimsMIRegister and AimsManualRegistration).</para></listitem>
      		<listitem><para>Using Anatomist transformation control in order to do a manual registration.</para></listitem>
		<listitem><para>Convert .mat files into .trm files with BrainVISA processes : 
		<emphasis role="bold">fMRI => converters => SPM to AIMS transformation converter</emphasis> and 
		<emphasis role="bold">fMRI => converters => SPM sn3d to AIMS transformation converter</emphasis>. These processes need a Matlab licence. Only affine part of the transformation is converted.</para></listitem>
		<listitem><para>You can write your own transformation file.</para></listitem>
		</itemizedlist>
                <sect3 id="ana_man%manual_registration" infoid="manual registration with transformation control">
                  <title>Manual registration using Anatomist transformation control</title>
                  <para>Example : <emphasis>manual registration</emphasis>between a functional volume (Vf)  and an anatomical volume (Va)<orderedlist>
                      <listitem>
                        <para>Load the volumes Va and Vf.</para>
                      </listitem>
                      <listitem>
                        <para>Fusion the 2 volumes to see how their relative position.</para>
                      </listitem>
                      <listitem>
                        <para>Put the volume that have to be moved, Vf, in a window.</para>
                      </listitem>
                      <listitem>
                        <para>Select Vf in the window : 
                          - Right click on the window
                          - Choose <emphasis>View / select objects</emphasis>
                          - select Vf in the browser window.</para>
                      </listitem>
                      <listitem>
                        <para>In the window containing Vf, click on the transformation control.
                        </para>
                      </listitem>
                      <listitem>
                        <para>You can move Vf in its window using the keyboard shortcuts.</para>
                        <para>NB : When you move Vf, a new referential is assigned to it. Indeed, Vf and Va are in two different referentials, and the transformation between these referentials is being computed.</para>
                        <para>NB : While you are moving Vf and Va, don't forget to look at all views : axial, coronal and sagittal. </para>
                      </listitem>
                      <listitem>
                        <para>Save the transformation :</para>
                        <para>- <emphasis>Settings -> Referential window</emphasis>
                        </para>
                        <para>- The referential window opens. Each referential is represented by a colored round. </para>
                        <para>- Find the arrow betwenn Va and Vf referentials</para>
                        <para>- Right click on it and choose <emphasis>Save transformation</emphasis>
                        </para>
                        <para>- Generally, the name is something like *TO*.trm, for example <emphasis>VfTOVa.trm</emphasis>
                        </para>
                      </listitem>
                      <listitem>
                        <para>Edit the .trm file with a simple text editor to see the parameters of the transformation.
                        </para>
                      </listitem>
                    </orderedlist>
                  </para>

                </sect3>
                
		</sect2>

                <sect2 id="ana_man%apply_builtin_referential" infoid="Apply builtin referential SPM/NIFTI">
                  <title>Using transformation information contained in SPM/NIFTI headers</title>
                  <para>SPM and NIFTI formats can put informations about referentials and transformations in the header file.This information can be found in attributes <emphasis>spm_origin, referentials, transformations</emphasis>.
                    It deals with referentials used in SPM. It can be useful to load these referentials and transformations when you have several images which are aligned in one of these referentials.</para> 
                  <para>The Anatomist feature <emphasis>Apply builtin referential</emphasis> (in object menu -> referential) loads the referentials and transformations mentionned in the header. If there is no trnaformation information, the feature does nothing. You can see the new referentials and transformations in the referentials window (in settings menu). The referential assigned to the object also changes. But by default, the display doesn't changes. Indeed, default window's referential is <emphasis>Talairach AC/PC Anatomist</emphasis> and there's generally no link between this referential and referential of the object. If there is a tranformation between object's referential and another referential and you change the window's referential to this destination referential, the display will change. </para>
                  <para>If you set the user level to <emphasis>Expert</emphasis>, you can see another transformation when using <emphasis>Apply builtin referential</emphasis> : the transformation between the referential of the data on disk and the referential of the loaded object. This information is in <emphasis>storage_to_memory</emphasis> attribute. </para>
        </sect2>

    </sect1>
  </chapter>

    <chapter id="ana_man%roi_toolbox" infoid="ROI drawing toolbox">
      <title>ROI drawing toolbox</title>
      <para>
        <emphasis role='bold'>What is the file format for ROI ?</emphasis>
      </para>
      <para>Regions of interest are stored in a graph where each node is a ROI. Some attributes are associated to the graph and its nodes : the voxels size, name of each region... The file format is a couple <emphasis>.arg/.data</emphasis>. The .data is a directory and contains data of each region. The .arg is a file and contains the graph's structure, that is to say nodes organisation. </para>
      <para>It is also possible to export a ROI as a mask (a binary volume) using the option <emphasis>Region => Export as mask</emphasis> in ROI toolbox menu.</para>
      <para/>
      <para>
        <emphasis role='bold'>Accepted file formats to draw ROIs</emphasis>
      </para>
      <para>You can draw ROI on 2D, 3D and 4D volumes.</para>
      <para/>
      <para>
        <emphasis role='bold'>How to open ROI toolbox ?</emphasis>
      </para>
      <para>You can either click on icon &fb_roi; in a window containing a volume, or press F1 key (obviously it will work only if there is a window containing a volume).
	</para>
      <para/>
      <para>
        <emphasis role='bold'>Some rules ...</emphasis>
        <itemizedlist>
          <listitem>
            <para>A voxel cannot be in more than one region.</para>
          </listitem>
          <listitem>
            <para>You shouldn't draw on a volume whose voxels size is different from the one of the graph. If it occurs, Anatomist will show a warning message.
	    
	<figure><title>Warning message when volume's and graph's voxels size are different.</title>
	<mediaobject>
	<imageobject role="fop"><imagedata fileref="&DIR_IMG;roi1.png" format="PNG"  width="285"/></imageobject>
	<imageobject role="html"><imagedata fileref="&DIR_IMG;roi1.png" format="PNG"/></imageobject>
	</mediaobject>
	</figure>	    
	      
            </para>
          </listitem>
        </itemizedlist></para>
	
      <sect1>
        <title>ROI management interface</title>
        <para>Here is the graphical user interface to manage ROIs :</para>

	<figure><title><emphasis>ROI management</emphasis> interface</title>
	<mediaobject>
	<imageobject role="fop"><imagedata fileref="&DIR_IMG;roi4_control.png" format="PNG"  width="350"/></imageobject>
	<imageobject role="html"><imagedata fileref="&DIR_IMG;roi4_control.png" format="PNG"/></imageobject>
	</mediaobject>
	</figure>
	
	
        <sect2>
          <title><emphasis>Session</emphasis> menu
          </title>
          <para>
            A session is actually a ROI graph. This menu enables to create a new graph, open an existing one, closing current graph...
            <table>
              <title>Menu <emphasis>Session</emphasis>
              </title>
              <tgroup align="justify" cols="2">
                <thead>
                  <row>
                    <entry>Option</entry>
                    <entry>Description</entry>
                  </row>
                </thead>
                <tbody>
                  <row>
                    <entry>
                      <para>New</para>
                    </entry>
                    <entry>
                      <para>Creates a new ROI graph. The default name is created according to the name of the selected volume in <emphasis>Image</emphasis> panel. You can change the name of the graph using <emphasis>Save as</emphasis> option.</para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>Open</para>
                    </entry>
                    <entry>
                      <para>Loads a graph.</para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>Close</para>
                    </entry>
                    <entry>
                      <para>Closes the selected graph.</para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>Save</para>
                    </entry>
                    <entry>
                      <para>Saves the selected graph.</para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>Save as</para>
                    </entry>
                    <entry>
                      <para>Saves and eventually renames the selected graph.</para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>Clean</para>
                    </entry>
                    <entry>
                      <para>Deletes all isolated voxels. If you have drawn voxels by mistake, you can delete them using this option.</para><para></para>
                    </entry>
                  </row>
                </tbody>
              </tgroup>
            </table>
          </para>
        </sect2>
        <sect2>
          <title><emphasis>Region</emphasis> menu
          </title>
          <para>
            This menu enables to manage the regions of the selected graph. 
            <table>
              <title><emphasis>Region</emphasis> menu
              </title>
              <tgroup align="justify" cols="2">
                <thead>
                  <row>
                    <entry>Option</entry>
                    <entry>Description</entry>
                  </row>
                </thead>
                <tbody>
                  <row>
                    <entry>
                      <para>New</para>
                    </entry>
                    <entry>
                      <para>Creates a new region in the graph. The set of allowed names depends on the selected framework in <emphasis>FrameWork</emphasis> option. If you want to choose your own names, use the  <emphasis>Free</emphasis> framework (default). You can also load your own framework using <emphasis>FrameWork</emphasis> => <emphasis>Personal </emphasis> => <emphasis>Load</emphasis> menu.</para>
			<para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>Delete</para>
                    </entry>
                    <entry>
                      <para>Deletes selected region.</para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>Fusion</para>
                    </entry>
                    <entry>
                      <para>Merges several regions. The following window opens and you can select the regions that have to be merged and the name of the final region among selected regions names.</para><para></para>
		
			<mediaobject>
			<imageobject role="fop"><imagedata fileref="&DIR_IMG;roi2.png" format="PNG"  width="120"/></imageobject>
			<imageobject role="html"><imagedata fileref="&DIR_IMG;roi2.png" format="PNG"/></imageobject>
			</mediaobject>
		
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>Export as a mask</para>
                    </entry>
                    <entry>
                      <para>Saves selected region as a binary mask (label volume).</para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>Morphos Stats</para>
                    </entry>
                    <entry>
                      <para>Displays the volume in mm3 of the selected region in the console used to run Anatomist.</para><para></para>
                    </entry>
                  </row>
                </tbody>
              </tgroup>
            </table>
          </para>
        </sect2>
        <sect2>
          <title><emphasis>FrameWork</emphasis> menu
          </title>
          <para>
            This menu manages nomenclatures used to name the regions. 
            <table>
              <title><emphasis>FrameWork</emphasis> menu
              </title>
              <tgroup align="justify" cols="2">
                <thead>
                  <row>
                    <entry>Option</entry>
                    <entry>Description</entry>
                  </row>
                </thead>
                <tbody>
                  <row>
                    <entry>
                      <para>Neuro, Lateral Neuro, Sulci, Rat_wb</para>
                    </entry>
                    <entry>
                      <para>Pre-defined frameworks.</para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>Personal</para>
                    </entry>
                    <entry>
                      <para>Enables to create and load custom nomenclatures.</para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>Free</para>
                    </entry>
                    <entry>
                      <para>No selected nomencalture, each region name is given by the user. </para><para></para>
                    </entry>
                  </row>
                </tbody>
              </tgroup>
            </table>
          </para>
        </sect2>
        <sect2>
          <title><emphasis>Personal</emphasis> sub-menu
          </title>
          <para>
            This menu manages custom nomenclatures.
            <table>
              <title><emphasis>Personal</emphasis> sub-menu
              </title>
              <tgroup align="justify" cols="2">
                <thead>
                  <row>
                    <entry>Option</entry>
                    <entry>Description</entry>
                  </row>
                </thead>
                <tbody>
                  <row>
                    <entry>
                      <para>New</para>
                    </entry>
                    <entry>
                      <para>Creates a new nomenclature for ROI graphs. You first enter a name for the new nomenclature in a pop-up window. Then, a new object is created and shown in Anatomist main window. New sub-menus are available in <emphasis>Personal</emphasis> menu : <emphasis>Define new region</emphasis>, <emphasis>Modify region name</emphasis> and <emphasis>Modify region color</emphasis>. You cannot define two nomenclatures at the same time. If you define a second nomenclature, you can save the first, else it will be deleted.</para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>Load</para>
                    </entry>
                    <entry>
                      <para>Loads an existing nomenclature.</para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>Save</para>
                    </entry>
                    <entry>
                      <para>The nomenclature is saved in Anatomist config directory of the current user : <emphasis>user_home_directory/.anatomist/frameworks</emphasis>. You cannot choose the place to save the nomenclature.</para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>Define new region</para>
                    </entry>
                    <entry>
                      <para>Sub-menu available on creating a new nomenclature. Enables to define a new region by giving its name and color.</para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>Modify region name</para>
                    </entry>
                    <entry>
                      <para>Sub-menu available on creating a new nomenclature. Enables to modify the name of the current region.</para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>Modify region color</para>
                    </entry>
                    <entry>
                      <para>Sub-menu available on creating a new nomenclature. Enable to modify the color of the current region.</para><para></para>
                    </entry>
                  </row>
		  <row>
                    <entry>
                      <para>Delete region name</para>
                    </entry>
                    <entry>
                      <para>This option enables to remove the current region from the nomenclature.</para><para></para>
                    </entry>
                  </row>
                </tbody>
              </tgroup>
            </table>
          </para>
        </sect2>
        <sect2>
          <title><emphasis>Windows</emphasis> menu
          </title>
          <para>
            <table>
              <title><emphasis>Windows</emphasis> menu
              </title>
              <tgroup align="justify" cols="2">
                <thead>
                  <row>
                    <entry>Option</entry>
                    <entry>Description</entry>
                  </row>
                </thead>
                <tbody>
                  <row>
                    <entry>
                      <para>Axial</para>
                    </entry>
                    <entry>
                      <para>Opens an axial window containing the volume and the ROI graph selected in image and session panels of the ROI toolbox window.</para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>Sagittal</para>
                    </entry>
                    <entry>
                      <para>Opens a sagittal window containing the volume and the ROI graph selected in image and session panels of the ROI toolbox window.</para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>Coronal</para>
                    </entry>
                    <entry>
                      <para>Opens a coronal window containing the volume and the ROI graph selected in image and session panels of the ROI toolbox window.</para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>3D</para>
                    </entry>
                    <entry>
                      <para>Opens an 3D window containing the volume and the ROI graph selected in image and session panels of the ROI toolbox window.</para><para></para>
                    </entry>
                  </row>
                </tbody>
              </tgroup>
            </table>
          </para>
        </sect2>
      </sect1>
      <sect1>
        <title>ROI painting</title>
        <para>
	
	<figure><title><emphasis>Paint</emphasis> tab</title>
	<mediaobject>
	<imageobject role="fop"><imagedata fileref="&DIR_IMG;roi5_dessin.png" format="PNG"  width="350"/></imageobject>
	<imageobject role="html"><imagedata fileref="&DIR_IMG;roi5_dessin.png" format="PNG"/></imageobject>
	</mediaobject>
	</figure>
	
        </para>
        <sect2>
          <title><emphasis>Brush</emphasis> panel
          </title>
          <para>
            <table>
              <title><emphasis>Brush</emphasis> panel
              </title>
              <tgroup align="justify" cols="2">
                <thead>
                  <row>
                    <entry>Action</entry>
                    <entry>Description</entry>
                  </row>
                </thead>
                <tbody>
                  <row>
                    <entry>
                      <para>Brushes</para>
                    </entry>
                    <entry><para>
                      <itemizedlist>
                        <listitem>
                          <para>
                            <emphasis>Point </emphasis> : draw one voxel at a time.</para>
                        </listitem>
                        <listitem>
                          <para>
                            <emphasis>Disk </emphasis> : draw a &quot;disk&quot; within a radius of the  &quot;brush radius &quot; size on one slice at a time.</para><para></para>
                        </listitem>
                        <listitem>
                          <para>
                            <emphasis>Ball </emphasis> : draw a &quot;ball&quot; within a radius of the &quot;brush radius&quot; size on several slices.</para><para></para>
                        </listitem>
                      </itemizedlist></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>Brush radius</para>
                    </entry>
                    <entry>
                      <para>Brush size in voxel or mm according to the chosen option in <emphasis>Modes</emphasis>panel</para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>Opacity</para>
                    </entry>
                    <entry>
                      <para>Sets the opacity of drawn ROIs. Decrease it to increase transparency.</para><para></para>
                    </entry>
                  </row>
                </tbody>
              </tgroup>
            </table>
          </para>
        </sect2>
        <sect2>
          <title><emphasis>Modes</emphasis> panel
          </title>
          <para>
            <table>
              <title><emphasis>Modes</emphasis> Panel
              </title>
              <tgroup align="justify" cols="2">
                <thead>
                  <row>
                    <entry>Action</entry>
                    <entry>Description</entry>
                  </row>
                </thead>
                <tbody>
                  <row>
                    <entry>
                      <para>
                        <emphasis>Line</emphasis>
                      </para>
                    </entry>
                    <entry>
			<para>
                      <itemizedlist>
                        <listitem>
                          <para>
                            <emphasis>On</emphasis> : outlines that you draw will be continuous even if you draw rapidly. </para>
                        </listitem>
                        <listitem>
                          <para>
                            <emphasis>Off</emphasis> : if you draw rapidly, lines won't be continuous.</para>
                        </listitem>
                      </itemizedlist>
                          </para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>
                        <emphasis>Replace</emphasis>
                      </para>
                    </entry>
                    <entry>
                      <para>
                      <itemizedlist>
                        <listitem>
                          <para>
                            <emphasis>On</emphasis> : Each voxel on which you draw will be added to the current region, even if it was already in another region. For examle, if a voxel V is in a region A and you're drawing a region B passing on voxel V, this voxel will move to region B.</para>
                        </listitem>
                        <listitem>
                          <para>
                            <emphasis>Off</emphasis> : a voxel which is already in a region cannot be put in another one.</para>
                        </listitem>
                      </itemizedlist>
                      </para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>
                        <emphasis>LinkedCursor</emphasis>
                      </para>
                    </entry>
                    <entry>
                      <para>
                        <itemizedlist>
                          <listitem>
                            <para>
                              <emphasis>On</emphasis> : you can see your ROI in several views simultaneously while drawing.</para>
                          </listitem>
                          <listitem>
                            <para>
                              <emphasis>Off</emphasis> : you cannot see your ROI in several views simultaneously while drawing.</para>
                          </listitem>
                        </itemizedlist>
                      </para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>
                        <emphasis>BrushUnit</emphasis>
                      </para>
                    </entry>
                    <entry>
                      <para>
                        <itemizedlist>
                          <listitem>
                            <para>
                              <emphasis>Voxel</emphasis> : the unit for the brush radius size is the voxel.</para>
                          </listitem>
                          <listitem>
                            <para>
                              <emphasis>mm</emphasis> : the unit for the brush radius size is the mm.</para>
                          </listitem>
                        </itemizedlist>
                      </para>
                    </entry>
                  </row>
                </tbody>
              </tgroup>
            </table>
          </para>
        </sect2>
      </sect1>
      <sect1>
        <title>Mathematical morphology</title>
        <para>This tab offers basic tools for mathematical morphology : operations (dilatation, erosion...) realized on selected ROIs. You can choose the structuring element radius in voxels or in mm and realize 4 types of actions : erosion, dilatation, opening, closure.</para>
        
	
        <figure><title><emphasis>Mathematical morphology</emphasis> tab</title>
	<mediaobject>
	<imageobject role="fop"><imagedata fileref="&DIR_IMG;roi6_morpho.png" format="PNG"  width="350"/></imageobject>
	<imageobject role="html"><imagedata fileref="&DIR_IMG;roi6_morpho.png" format="PNG"/></imageobject>
	</mediaobject>
	</figure>
	
        <sect2>
          <para>
            <table>
              <title>Structuring element radius</title>
              <tgroup align="justify" cols="2">
                <thead>
                  <row>
                    <entry>Action</entry>
                    <entry>Description</entry>
                  </row>
                </thead>
                <tbody>
                  <row>
                    <entry>
                      <para>Structuring element radius</para>
                    </entry>
                    <entry>
                      <para>The structuring element is shape composed of a set of points. The center of the element is applied in each voxel of the ROI. Here, the structuring element is a neighbourhood with a connexity of 6. </para>
                    </entry>
                  </row>
                </tbody>
              </tgroup>
            </table>
          </para>
        </sect2>
        <sect2>
          <para>
            <table>
              <title>Distance mode</title>
              <tgroup align="justify" cols="2">
                <thead>
                  <row>
                    <entry>Action</entry>
                    <entry>Description</entry>
                  </row>
                </thead>
                <tbody>
                  <row>
                    <entry>
                      <para>
                        <emphasis>mm</emphasis>
                      </para>
                    </entry>
                    <entry>
                      <para>The structuring element radius is in mm.</para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>
                        <emphasis>voxel</emphasis>
                      </para>
                    </entry>
                    <entry>
                      <para>The structuring element radius is in voxels.</para><para></para>
                    </entry>
                  </row>
                </tbody>
              </tgroup>
            </table>
          </para>
        </sect2>
        <sect2>
          <para>
            <table>
              <title>Mathematical morphology actions</title>
              <tgroup align="justify" cols="2">
                <thead>
                  <row>
                    <entry>Action</entry>
                    <entry>Description</entry>
                  </row>
                </thead>
                <tbody>
                  <row>
                    <entry>
                      <para>
                        <emphasis>Erosion</emphasis>
                      </para>
                    </entry>
                    <entry>
                      <para>Outline erosion : if the structuring element placed in a point of the ROI has an intersection with the volume outside the ROI, these intersection points are added to the ROI.</para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>
                        <emphasis>Dilatation</emphasis>
                      </para>
                    </entry>
                    <entry>
                      <para>Outline dilatation : if the structuring element placed in a point of the ROI has an intersection with the volume outside the ROI, this point is removed from the ROI.</para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>
                        <emphasis>Opening</emphasis>
                      </para>
                    </entry>
                    <entry>
                      <para>Erosion then dilatation. This action enables to remove some little isolated regions, to smooth outline and to separate objects weakly linked.</para><para></para>
                    </entry>
                  </row>
                  <row>
                    <entry>
                      <para>
                        <emphasis>Closure</emphasis>
                      </para>
                    </entry>
                    <entry>
                      <para>Dilatation then erosion. This action enables to remove some little holes and to connect objects.</para><para></para>
                    </entry>
                  </row>
                </tbody>
              </tgroup>
            </table>
          </para>
        </sect2>
      </sect1>
      <sect1>
        <title>Connectivity threshold</title>
        <para>This module enables to make a semi-automatic segmentation of a volume. You define a band of gray levels by selecting a low level threshold and high level threshold. Corresponding regions are highlighted  and added to current region when you click on them. You can also export this region as a mask.</para>
        
	<figure><title><emphasis>Connectivity threshold</emphasis> tab</title>
	<mediaobject>
	<imageobject role="fop"><imagedata fileref="&DIR_IMG;roi7_seuilcnx.png" format="PNG"  width="350"/></imageobject>
	<imageobject role="html"><imagedata fileref="&DIR_IMG;roi7_seuilcnx.png" format="PNG"/></imageobject>
	</mediaobject>
	</figure>	
	
	
        <para>At the top you see the histogram of your volume. Vous pouvez visualiser l'histogramme de votre volume sur la premire partie haute de l'onglet. y-coordinate is the frequency of a gray level and x-coordinate is its value.</para>
        <table>
          <title>Connectivity threshold panel</title>
          <tgroup align="justify" cols="2">
            <thead>
              <row>
                <entry>Field name</entry>
                <entry>Description</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>
                  <para>
                    <emphasis>Bins</emphasis>
                  </para>
                </entry>
                <entry>
                  <para>Number of splitting of gray levels scale.</para><para></para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    <emphasis>Ingnore under low</emphasis>
                  </para>
                </entry>
                <entry>
                  <para>This option enables to update the frequencies of gray levels in the histogram according to the values of <emphasis>high level</emphasis> and <emphasis>low level</emphasis>.</para><para></para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    <emphasis>Histo Image</emphasis> / <emphasis>Histo ROI</emphasis>
                  </para>
                </entry>
                <entry>
                  <itemizedlist>
                    <listitem>
                      <para>
                        <emphasis>Histo Image</emphasis> : show the histogram of the volume for which connectivity threshold is activated.</para>
                    </listitem>
                    <listitem>
                      <para>
                        <emphasis>Histo ROI</emphasis> : show the histogram of each ROI of the selected graph.</para>
                    </listitem>
                  </itemizedlist>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    <emphasis>Save Histos</emphasis>
                  </para>
                </entry>
                <entry>
                  <para>Saving all histograms (volume and ROIs histograms) in a text file. A file dialog opens and enables to choose the name of the file. The format of this file is .anahis. The extension is optional and the file is readable with any text editor. See appendix about <link linkend="ana_man%a_fanahis">.anahis format</link>.</para><para></para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    <emphasis>Activate threshold preview</emphasis>
                  </para>
                </entry>
                <entry>
                  <itemizedlist>
                    <listitem>
                      <para>
                        <emphasis>Activate threshold preview</emphasis> : enable this option. If this button is not on, none of the other action is available.</para>
                    </listitem>
                    <listitem>
                      <para>
                        <emphasis>Deactivate threshold preview</emphasis> : disable this option.</para>
                    </listitem>
                  </itemizedlist><para></para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    <emphasis>Low level</emphasis>
                  </para>
                </entry>
                <entry>
                  <para>Move the cursor to set the low threshold of gray levels.</para><para></para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    <emphasis>High level</emphasis>
                  </para>
                </entry>
                <entry>
                  <para>Move the cursor to set the high threshold of gray levels.</para><para></para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    <emphasis>Dimension</emphasis>
                  </para>
                </entry>
                <entry>
                  <itemizedlist>
                    <listitem>
                      <para>
                        <emphasis>2D</emphasis> : the region will be a 2D volume, it will be only in the selected slice.</para>
                    </listitem>
                    <listitem>
                      <para>
                        <emphasis>3D</emphasis> : the regions will be a 3D volume.</para>
                    </listitem>
                  </itemizedlist>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    <emphasis>Mix method</emphasis>
                  </para>
                </entry>
                <entry>
                  <itemizedlist>
                    <listitem>
                      <para>
                        <emphasis>Geometric</emphasis> : geometric fusion between the volume and the region defined by the threshold.</para>
                    </listitem>
                    <listitem>
                      <para>
                        <emphasis>Linear</emphasis> : linear fusion between the volume and the region defined by the threshold.</para>
                    </listitem>
                  </itemizedlist>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    <emphasis>Mixing factor</emphasis>
                  </para>
                </entry>
                <entry>
                  <para>Mixing factor used for the <emphasis>linear</emphasis> fusion.</para><para></para>
                </entry>
              </row>
            </tbody>
          </tgroup>
        </table>
        <!-- <para> RQ Renaud : Certaines palettes 2D sont construites a partir de deux palettes 1d choisies par l'utilisateur. Pour les LevelSet du module de ROI, la seconde palettest est BLUE-ufusion.
</para>-->
      </sect1>
      <sect1>
        <title>Blob segmentation</title>
        <para>In a PET exam, you can use this module in order to isolate a region according to a local maximum. A <emphasis>blob</emphasis> is a region around a minimum or a maximum. Here is the steps of this segmentation :
	<itemizedlist>
          <listitem>Click on a point with <emphasis role='bold'>Shift + left button</emphasis> near an extremum.</listitem>
	<listitem>The algorithm searches for the closest maximum.</listitem>
        <listitem>From this maximum, the region grows under 2 conditions : 
          <itemizedlist>
            <listitem>the region's size must not exceed the maximum size given by the field  <emphasis>region max size</emphasis> (in mm3).</listitem>
            <listitem>the values must not be lower than the threshold given in the field <emphasis>percentage of extremum</emphasis>.</listitem>
          </itemizedlist>
        </listitem>
	<listitem>When the segmentation is over, the region is displayed.</listitem>
        <listitem>NB : it can occur that the region doesn't contain the original voxel, the a warning message indicates that you have to click closer.</listitem>	
	</itemizedlist>	
	</para>
	
        <!--
Il recherche l'extremum le plus proche et opre une "descente (extraction de maximum) 
ou montee des eaux (extraction de minimum)", ce qui correspond a un seuillage connexe au point clique, 
jusqu'a ce que la taille de la region depasse la taille max donnee, ou que le niveau des eaux depasse le pourcentage de l'extremum. 
-->
        <table>
          <title>Blob segmentation</title>
          <tgroup align="justify" cols="2">
            <thead>
              <row>
                <entry>Field name</entry>
                <entry>Description</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>
                  <para>
                    <emphasis>Region max size</emphasis>
                  </para>
                </entry>
                <entry>
                  <para>Maximum volume for the blob in mm3. For example, if the voxel resolution is 4x4x4 mm (the volume of a voxel is 64mm3) and you set 1280 mm3, the region size is 20 voxels.</para><para></para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    <emphasis>Percentage of extremum</emphasis>
                  </para>
                </entry>
                <entry>
                  <para>Percentage of the maximum value. It is possible to change between a maximum and a minimum using keys <emphasis role='bold'>Shift+B</emphasis>  
		  (to a maximum) and <emphasis role='bold'>Control+B</emphasis> (to a minimun).</para><para></para>
                </entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </sect1>
    
      
      <sect1>
        <title>ROI drawing mode by label selection</title>
        <para>Some volumes are called <emphasis>image of labels</emphasis>, that is to say each part/structure of the volume is identified by a voxel value : a numerical label. For example, in the following image, the volume contains the background, the left and right hemispheres and the cerebellum. And each part is associated to a label : voxels have value 1 in the left hemisphere, 2 in the right hemisphere, and 3 in the cerebellum. </para>
	
	<figure><title>Image of labels (displayed in radiological convention)</title>
	<mediaobject>
	<imageobject role="fop"><imagedata fileref="&DIR_IMG;image_label.png" format="PNG"  width="280"/></imageobject>
	<imageobject role="html"><imagedata fileref="&DIR_IMG;image_label.png" format="PNG"/></imageobject>
	</mediaobject>
	</figure>
	
	<para>With this control, you can select regions according to a label. For example, if your volume V has the labels : 1, 2 and 3 : 
	<itemizedlist>
        <listitem>Load the volume V in Anatomist.</listitem>
        <listitem>Put it in a window and click on the ROI control.</listitem>
	<listitem>Create a ROI graph G and a region R to store your selection.</listitem>
	<listitem>In the window containing the volume V and the graph G, click on the label selection control	&fb_name;.</listitem>
	<listitem>Click on a voxel which value is the required label.</listitem>
	<listitem>A warning message appears is data is huge, click on <emphasis>yes</emphasis> to go on.</listitem>
	<listitem>You will see better your region in a 3D window.</listitem>
	<listitem>The region R of the graph G now contains the selected region. You can store this ROI graph or export this region as a mask to get a volume.</listitem>
	<listitem>NB : in advanced use, you can substract sub-regions using the control's options.</listitem>		
	</itemizedlist>	
	</para>
	
      </sect1>
     
    </chapter>
    <chapter id="ana_man%handling_graph" infoid="handling a graph">
      <title>Handling a graph</title>
      <para>As we saw before, graphs enable to represent structured data with nodes and associated attributes. Graphs also have global attributes defining characteristics shared by all nodes, as for example voxels size. Nodes also can be linked by relations. This is used in sulci graphs to represent several units extracted from a sulcus. You can see these relations by selecting the neighbours of a node.</para>
	
	<para>The main attributes in graph nodes (for sulci and ROI graphs) are <emphasis>name</emphasis> and <emphasis>label</emphasis>. These 2 attributes have the same role : naming a node. Then, it is possible to make a link with a nomenclature file in order to associate a color to each value of attributes <emphasis>name</emphasis> or <emphasis>label</emphasis>.</para>
	<para>
        <emphasis>So, what's the use having 2 different attributes with the same role ?</emphasis> In some case, we need a double identification. For example, in a automatic sulci recognition, nodes are renamed by <emphasis>computer experts</emphasis>. When consulting the results, you might want to rename a sulcus and keep the original identification, which is highly recommended.</para>

      <sect1>
        <title>Browsing a graph through its nodes.</title>
        <para>Follow these steps :<itemizedlist>
            <listitem>
              <para>Put the graph in a 3D window. The nodes are not visible yet. Indeed, for big graph, it is more convenient to see only chosen nodes rather than all nodes.</para>
            </listitem>
            <listitem>
              <para>Right click on the window and select the menu <emphasis>View / select objects</emphasis>. A browser window opens. </para>
            </listitem>
            <listitem>
              <para>Then, you can select the nodes you want to see by clicking on it in the browser window.</para>
            </listitem>
            <listitem>
              <para>When a node is selected in the browser window, it becomes visible as an object in the 3D window.</para>
            </listitem>
          </itemizedlist>
        </para>
        <para>
          If you want to see <emphasis role="bold">all the nodes of a graph</emphasis>, you can use the object menu <emphasis>Display -> Display nodes</emphasis> available by right clicking on the graph. Selects a window and use this feature, the graph will be loaded in the window and its nodes become visible. If there is no opened window, Anatomist will open a new 3D window and load the graph in it. If there are several windows and none is selected, Anatomist will load the graph in each window. 
        </para>
      </sect1>
      <sect1>
        <title>Selecting nodes</title>
        <para><itemizedlist>
            <listitem>
              <para>Move to selection mode by clicking on the selection control &fb_select; of the 3D window containing the graph.</para>
            </listitem>
            <listitem>
              <para>Then you can <emphasis role="bold">select visible nodes clicking on them</emphasis>. The selected node change color in the 3D window and become selected also in the corresponding browser window. You can select several nodes keeping <emphasis>ctrl</emphasis> key pressed.</para>
            </listitem>
            <listitem>
              <para>You can also <emphasis role="bold">select neighbours</emphasis> of a node by choosing <emphasis>select neighbours</emphasis> in right-click menu. A node has neighbours when there are relations between the nodes. So you can select neighbours in a sulci graph where such relations exist, but generally not in ROI graph because there's no link between different regions.</para>
            </listitem>
            <listitem>
              <para>You can <emphasis role="bold">undo selection</emphasis> by choosing <emphasis>unselect</emphasis> in right-click menu. This feature undo selection for all nodes currently selected. These nodes retrieve their original color.</para>
            </listitem>
            <listitem>
              <para>Finally, it is possible to remove nodes from the window by selecting them and choosing <emphasis>remove from this window</emphasis> in right-click menu.</para>
            </listitem>
          </itemizedlist>
        </para>
      </sect1>
      <sect1>
        <title>Graph parameters</title>
        <para>The graph parameters configuration window is available through : <emphasis>Settings</emphasis> => <emphasis>Graph parameters</emphasis>
          
	<figure> <title>Graph parameters window</title>
	<mediaobject>
	<imageobject role="fop"><imagedata fileref="&DIR_IMG;window_paramgraphe.png" format="PNG"  width="200"/></imageobject>
	<imageobject role="html"><imagedata fileref="&DIR_IMG;window_paramgraphe.png" format="PNG"/></imageobject>
	</mediaobject>
	</figure>  
	  
        </para>
        <para>Graph 3D display mode<itemizedlist>
            <listitem>
              <para>Display triangulations : object surface is smoothed.</para>
            </listitem>
            <listitem>
              <para>Display facets : display &quot;voxels&quot;.</para>
            </listitem>
            <listitem>
              <para>Display  : display smoothed surface and voxels.</para>
            </listitem>
            <listitem>
              <para>Display first object : nodes in a graph can be made up of several objects that can be displayed by Anatomist. For example, in a sulci graph, nodes are made up of 4 displayable objects : 3 buckets (voxels lists) and 1 mesh. By choosing this option, only the first of these objects is displayed for each node. In a sulci graph, the first object is the mesh representing the sulcus. </para>
            </listitem>
          </itemizedlist>
        </para>
        <para>Colors (2D / 3D)<itemizedlist>
            <listitem>
              <para>Use Nomenclature/color bindings (if any) : enables to link attributes of the loaded nomenclature and of the loaded graphs. </para>
            </listitem>
            <listitem>
              <para>Use attribute Label/name : nomenclatures and graphs are linked through <emphasis>Label</emphasis> or <emphasis>Name</emphasis> attribute.</para>
            </listitem>
            <listitem>
              <para>Display Tooltips : display information tooltips when the mouse passes on objects. Afficher les bulles : affiche les bulles d'informations lorsque la souris est dplace sur les objets.</para>
            </listitem>
          </itemizedlist>
        </para>
        <para>Selection color<itemizedlist>
            <listitem>
              <para>Use inverse color : the color of the object is inverted when it is selected.</para>
            </listitem>
            <listitem>
              <para>Constant color : the color of selected objects is always the same. You can change it by clicking on the colored square.</para>
            </listitem>
          </itemizedlist>
        </para>
        <para>IO saving settings<itemizedlist>
            <listitem>
              <para>Default (as loaded)</para>
            </listitem>
            <listitem>
              <para>Use one file per sub-object type</para>
            </listitem>
            <listitem>
              <para>Use one file per individual sub-object</para>
            </listitem>
            <listitem>
              <para>Save only modified sub-objects</para>
            </listitem>
            <listitem>
              <para>Set sub-objects dir. from graph filename</para>
            </listitem>
          </itemizedlist>
        </para>
      </sect1>
      <sect1>
        <title>Using nomenclatures</title>
        <para> Using a nomenclature file (icon : &list_nomenclature;) offers another way to browse a graph. For example, you load 2 labelled sulci graphs and the nomenclature of sulci recognition. Then you can select a sulcus by choosing its name in the nomenclature. So the choosen sulcus is displayed in each graph window.</para>
	<para>Using a nomenclature also enables to associate a color to a <emphasis>label</emphasis> and/or  a <emphasis>name</emphasis>. Thus you can standardize the display of graphs. A specific label or name will be displayed with the same color in every graph.</para>
        <para>A nomenclature file has the <emphasis>.hie</emphasis> extension and is a simple text file. et sont de simples fichiers texte. <!-- TODO : an annex to describe the nomenclature format --> </para>
        <para>Handle a nomenclature :<itemizedlist>
            <listitem>
              <para>Put the nomenclature in a browser window.</para>
            </listitem>
            <listitem>
              <para>You can now select nodes in graphs by clicking on the nomenclature's nodes. It is organized hierarchically. This means that you can select all the graph nodes that are under a nomenclature name by clicking on this name. For example, if you click on the name of a lobe, all sulci in this lobe become selected. And when you click on &quot;brain&quot; in a sulci nomenclature, all identified sulci become selected (but not thosewith the label  &quot;unknown&quot;). It makes it easy to visualize and select things by region.</para>
            </listitem>
          </itemizedlist>
        </para>
	<para>NB : Simple nomenclature files for ROIs can be created using <emphasis>Nomenclature => Personal</emphasis> menu in the ROIs module in Anatomist.</para>
        <para>NB : The nomenclature must match the graph type : value of &quot;graph_syntax&quot; attribute in the nomenclature must match &quot;Value&quot; colon displayed for the graph in a browser window (eg : &quot;CorticalFoldArg&quot; for a sulci graph).  </para>
      </sect1>
      <sect1>
        <title>Modifying the value of graph's attributes and saving a new graph</title>
        <para>You may need to modify some attributes values in a graph. For example, when you check sulci automatic recognition in a sulci graph obtained through a BrainVISA process. Indeed, during this process, each recognized sulcus is labelled using <emphasis>label</emphasis> attribute. Then, when you check the recognition, you can use the <emphasis>name</emphasis> attribute as a validation. Using the two attributes <emphasis>label</emphasis> et <emphasis>name</emphasis> enables to keep the automatic labelling and your manual labelling.</para>
        <para/>
        <para>Modifying the name attribute in a node and recording a new graph :<itemizedlist>
            <listitem>
              <para>Load the graph.</para>
            </listitem>
            <listitem>
              <para>Put the graph in a browser window.</para>
            </listitem>
            <listitem>
              <para>Unroll the node you want to modify.</para>
            </listitem>
            <listitem>
              <para>Go to the <emphasis>name</emphasis>attribute.</para>
            </listitem>
            <listitem>
              <para>Right click on it to display a menu.</para>
            </listitem>
            <listitem>
              <para>Choose <emphasis>Modify attribute</emphasis>.</para>
            </listitem>
            <listitem>
              <para>Put a new value for the attribute.</para>
            </listitem>
            <listitem>
              <para>When all modifications are done, go to the graph in Anatomist list of objets in the main window (left panel).</para>
            </listitem>
            <listitem>
              <para>Right click on the graph and choose <emphasis>File</emphasis> => <emphasis>Save</emphasis> in order to save the graph with the modifications. You can choose a new name or to keep the same but in this case the original graph will be erased.</para>
            </listitem>
          </itemizedlist>
        </para>
      </sect1>
    </chapter>
  
  <chapter>
    <title>Frequently Asked Questions (FAQ)</title>
    
<qandaset defaultlabel="none">


<qandaentry>
<question><para><emphasis role='bold'>Why objects and windows are not always in the same referential ? </emphasis></para></question>
<answer><para><emphasis>
Each object and window has its own referentials, they're independant and can be different. If an object and window have different referentials and a transformation between the two referentials exists, the transformation is applied to the object in order to visualize it in the window's referential.  If the transformation doesn't exist, no transformation is applied to the object and it is exactly as if the object and the window had the same referential. </emphasis></para></answer>
</qandaentry>


<qandaentry>
<question><para><emphasis role='bold'>How to create a transformation ?</emphasis></para></question>
<answer><para><emphasis> 
There are several ways :
<itemizedlist>
  <listitem><para>Using Aims commands to register 2 volumes (AimsMIRegister and AimsManualRegistration).</para></listitem>
  <listitem><para>Using Anatomist <link linkend="ana_man%d_ctr_transformation">transformation control</link> in order to do a manual registration.</para></listitem>
  <listitem><para>Convert .mat files into .trm files with BrainVISA processes : 
      <emphasis role="bold">fMRI => converters => SPM to AIMS transformation converter</emphasis> and 
      <emphasis role="bold">fMRI => converters => SPM sn3d to AIMS transformation converter</emphasis>. These processes need a Matlab licence. Only affine part of the transformation is converted.</para></listitem>
  <listitem><para>You can write your own transformation file.</para></listitem>
</itemizedlist>
</emphasis></para> </answer>
</qandaentry>

<qandaentry>
  <question><para><emphasis role='bold'>How to reorient an image if sagittal view is inverted ? </emphasis></para> </question>
  <answer><para><emphasis>You can use the commands AimsFlip or VipFlip in order to invert axis X, Y or Z.</emphasis></para> </answer>
</qandaentry>

<qandaentry>
  <question><para><emphasis role='bold'>What is the difference between superimposing and merging images ? </emphasis></para> </question>
  <answer><para><emphasis>A fusion creates a new object. There are several types of fusion : 2 volumes, a texture and a mesh... Superimposing object also enables to visualize several objects at the same but it doesn't create a new object. Whereas a fusion is a new object which has its own properties. </emphasis></para> </answer>
</qandaentry>

<qandaentry>
  <question><para><emphasis role='bold'>Is it possible to normalize with Anatomist ?  </emphasis></para> </question>
  <answer><para><emphasis>The only way would be to load a transformation to put an object in a known referential. </emphasis></para> </answer>
</qandaentry>

<qandaentry>
<question><para><emphasis role='bold'>What is the difference between loaded and displayed images in Anatomist ? </emphasis></para> </question>
<answer><para><emphasis>Loading an image doesn't modify it whereas it can be modified for display. For example, your loaded image is in radiological mode but you configured 'Display in neurological mode', so the image is modified only for display, but not on disk.</emphasis></para> </answer>
</qandaentry>

<qandaentry>
<question><para><emphasis role='bold'>Why talking about objects rather than images ? </emphasis></para> </question>
<answer><para><emphasis>Because Anatomist enables to visualize several types of objects, not only images. For example, a graph is not really an image but a structured object with nodes and attributes.</emphasis></para> </answer>
</qandaentry>

<qandaentry>
<question><para><emphasis role='bold'>How to obtain series of Analyze 3D images rather than Analyze 4D images ? </emphasis></para> </question>
<answer><para><emphasis>Set the field 'spm_output_4d_volumes' to 0 in configuration file .aimsrc. </emphasis></para> </answer>
</qandaentry>

<qandaentry>
<question><para><emphasis role='bold'>Why do I see a gap when I merge 2 normalized volumes ? </emphasis></para> </question>
<answer><para><emphasis>Indeed, Anatomist and SPM doesn't manage referentials in the same way. Particularly, it is not the same voxel that is considered as the origin of the volume. But information about referentials, transformations is generally written in the file header and Anatomist can read this information and load the corresponding referentials and transformations. To do that, use the option <link linkend="ana_man%apply_builtin_referential">Apply SPM/NIFTI Referential</link>.
</emphasis></para> </answer>
</qandaentry>

<qandaentry>
  <question><para><emphasis role='bold'>Why the origin of my volume (0,0,0) is located in the top right corner ? </emphasis></para> </question>
  <answer><para><emphasis>Indeed, in Anatomist, the voxel (0,0,0), the origin of the volume is located at the front top left corner of the volume's box. If you see, this point on the right, it is because your are in radiological mode, so the left and right are inverted in display. </emphasis></para> </answer>
</qandaentry>

<qandaentry>
<question><para><emphasis role='bold'>How to save a graph node (ROI, sulcus ...) into a volume ? </emphasis></para> </question>
<answer><para><emphasis>Load the graph, select the node and right-click on it. Then choose 'File' -> 'Export mask as volume'. </emphasis></para> </answer>
</qandaentry>

<qandaentry>
<question><para><emphasis role='bold'>How to zoom, translate and rotate a volume ? </emphasis></para> </question>
<answer><para><emphasis>Use Anatomist <link linkend="ana_man%d_ctr_def">default control</link>. To know the available keyboard shortcuts, pass the mouse on the control's icon. </emphasis></para> </answer>
</qandaentry>

<qandaentry>
<question><para><emphasis role='bold'>Why a graph isn't visible when I put it in a 3D window ?</emphasis></para> </question>
<answer><para><emphasis>By default, the graph nodes are not displayed because it can be heavy and not clear if there are a lot of nodes. You have to choose the node you want to see by selecting them. But it is also possible to ask for displaying all the node in graph display menu. See the section <link linkend="ana_man%handling_graph">Handling a graph</link>.</emphasis></para> </answer>
</qandaentry>

<qandaentry>
<question><para><emphasis role='bold'>How to know software version (Aims, BrainVISA and Anatomist) ? </emphasis></para> </question>
<answer><para><emphasis>
You can run an Aims command with --version option, for example AimsFileInfo --version. You can also read the version number at the top of Brainvisa and Anatomist interface..
</emphasis></para> </answer>
</qandaentry>

<qandaentry>
<question><para><emphasis role='bold'>How to know the volume of a region ?</emphasis></para> </question>
<answer><para><emphasis> There are 2 ways :
<itemizedlist>
<listitem> 1st : in Anatomist's ROI toolbox choose Region =&gt; Morpho Stats. The volume is displayed in the console.</listitem>
<listitem> 2nd : Aims commands AimsRoiFeatures or AimsVoiStat.</listitem>
</itemizedlist>
</emphasis></para> </answer>
</qandaentry>

<qandaentry>
<question><para><emphasis role='bold'>When I put a volume in a window, I don't see the volume. </emphasis></para> </question>
<answer><para><emphasis>Check that the window is in a mode : axial, coronal or sagittal. Indeed, if the window is a 3D window, you have to rotate the volume. By default it is not visible. To rotate, use the middle mouse button and move the mouse. </emphasis></para> </answer>
</qandaentry>


<qandaentry>
<question><para><emphasis role='bold'>How to draw a ROI on the 3 views at the same time ? </emphasis></para> </question>
<answer><para><emphasis>Check that the option <emphasis role='bold'>LinkedCursor</emphasis> is enable in the <emphasis role='bold'>Paint</emphasis> tab of the ROI toolbox and open all views (axial, coronal, sagittal et 3D) via <emphasis role='bold'>Painting views</emphasis> in ROI management tab. </emphasis></para> </answer>
</qandaentry>

<qandaentry>
<question><para><emphasis role='bold'>Can I draw on a fusion ?</emphasis></para> </question>
<answer><para><emphasis>No, this feature is not yet available.</emphasis></para> </answer>
</qandaentry>

<qandaentry>
  <question><para><emphasis role='bold'>Is it possible to draw a ROI on a mesh with Anatomist ? </emphasis></para> </question>
  <answer><para><emphasis>No. </emphasis></para> </answer>
</qandaentry>

</qandaset>
       
       
  </chapter>
  
 
  <glossary>
   <glossdiv>
      <title>B</title>
      <glossentry>
        <glossterm>Browser :</glossterm>
        <glossdef>
          <para>Generally a browser enables to visualize html pages (eg. Mozilla, Netscape ...). Anatomist has its own browser that displays information about objects.</para>
        </glossdef>
      </glossentry>
    </glossdiv>
    <glossdiv>
      <title>G</title>
      <glossentry id="ana_man%glos_geometric_fusion" infoid="geometric fusion glossary">
        <glossterm>Geometric fusion :</glossterm>
        <glossdef>
          <para>Creation of a new volume by merging two volumes. The value of voxels are obtained by mutltiplying rgb channels of source volumes.</para>
        </glossdef>
      </glossentry>
      <glossentry>
        <glossterm>Graph :</glossterm>
        <glossdef>
          <para>Structured object. A graph has global attributes and is composed of nodes, which also have attributes (eg. position, name, label, colour...). The nodes can be linked by relations (eg. sulci graph). There are several types of graphs, according to the nodes content.</para>
        </glossdef>
      </glossentry>
      <glossentry>
        <glossterm>ROI graph :</glossterm>
        <glossdef>
          <para>Each node is a region of interest.</para>
        </glossdef>
      </glossentry>
      <glossentry>
        <glossterm>Mesh graph :</glossterm>
        <glossdef>
          <para>Each node is a mesh. </para>
        </glossdef>
      </glossentry>
    </glossdiv>
    <glossdiv>
      <title>H</title>
      <glossentry>
        <glossterm>Header :</glossterm>
        <glossdef>
          <para>The header file stores attributes for an image.For example, GIS format is composed of a .ima file which contain the image and a .dim file which is the header. It contains information about the image as for example the image size, the voxel size, ... This file can be opened with a text editor or with a browser window in Anatomist.</para>
        </glossdef>
      </glossentry>
      <glossentry>
        <glossterm>Histogram (of a volume) :</glossterm>
        <glossdef>
          <para>distribution of voxels values intensity in a volume.</para>
        </glossdef>
      </glossentry>
    </glossdiv>
    <glossdiv>
      <title>I</title>
      <glossentry>
        <glossterm>Interpolation :</glossterm>
        <glossdef>
          <para>Computing method to get a voxel value in a new image from several voxel values. There are several methods : closest neighbour, bilinear, trilinear...</para>
        </glossdef>
      </glossentry>
    </glossdiv>
    <glossdiv>
      <title>L</title>
      <glossentry>
        <glossterm>Label image :</glossterm>
        <glossdef>
          <para>A label is associated to each voxel and it enables to make groups of voxels with the same label. For example, a binary image is a label image with two labels : 0 and 1.</para>
        </glossdef>
      </glossentry>
      <glossentry id="ana_man%glos_linear_fusion" infoid="linear fusion glossary">
        <glossterm>Linear fusion :</glossterm>
        <glossdef>
          <para>Linear combination of each voxel of each source volume, with an adjustable mixing rate 
	  (<emphasis> voxel1*fm1 + voxel2*fm2</emphasis> with fm1 and fm2 represents the mixing rate).</para>
        </glossdef>
      </glossentry>
    </glossdiv>
    <glossdiv>
      <title>M</title>
      <glossentry>
        <glossterm>Mesh :</glossterm>
        <glossdef>
          <para>3D object. Representation of an image or an object by a surface composed of polygons (triangles).</para>
        </glossdef>
      </glossentry>
    </glossdiv>
    <glossdiv>
      <title>N</title>
      <glossentry>
        <glossterm>Neurological convention :</glossterm>
        <glossdef>
          <para>Display and/or storage convention of volumes where the right side of the brain is diplayed at the right side of the image.</para>
        </glossdef>
      </glossentry>
      <glossentry>
        <glossterm>Normalisation :</glossterm>
        <glossdef>
          <para>Normalizing an image is resizing it according to a template. Useful to compare different images.</para>
        </glossdef>
      </glossentry>
      -->
    </glossdiv>
    <glossdiv>
      <title>O</title>
      <glossentry>
        <glossterm>Object :</glossterm>
        <glossdef>
          <para>In Anatomist, an object is any data structure that can be loaded an displayed. An object can be an image, a graph, a mesh, a texture...</para>
        </glossdef>
      </glossentry>
    </glossdiv>
    <glossdiv>
      <title>P</title>
      <glossentry>
        <glossterm>Palette :</glossterm>
        <glossdef>
          <para>Range of colours applied to an image voxels values.</para>
        </glossdef>
      </glossentry>
    </glossdiv>
    <glossdiv>
      <title>R</title>
      <glossentry>
        <glossterm>Radiological (convention) :</glossterm>
        <glossdef>
          <para>Display and/or storage convention where the right side of the brain is diplayed at the left side of the image. It's an historical convention linked to radiologists habits.</para>
        </glossdef>
      </glossentry>
      <glossentry>
        <glossterm>Referential :</glossterm>
        <glossdef>
          <para>Coordinates system.</para>
        </glossdef>
      </glossentry>
       <glossentry>
        <glossterm>Resolution of voxels :</glossterm>
        <glossdef>
          <para>Dimension of voxels along x, y and z axis in mm.</para>
        </glossdef>
      </glossentry>
      <glossentry>
        <glossterm>RGB channels:</glossterm>
        <glossdef>
          <para>Coding a colour by three values corresponding to Red, Green and Blue. Each colour has 256 possible values, so for each voxel there are 256x256x256 possible colours. Here are several examples of colour codes : <itemizedlist>
              <listitem>
                <para>black (0, 0, 0)</para>
              </listitem>
              <listitem>
                <para>blue (0, 0, 255)</para>
              </listitem>
              <listitem>
                <para>white (255, 255, 255)</para>
              </listitem>
              <listitem>
                <para>grey (128, 128, 128)</para>
              </listitem>
            </itemizedlist>
          </para>
        </glossdef>
      </glossentry>
    </glossdiv>
    <glossdiv>
      <title>S</title>
      <glossentry>
        <glossterm>Segmentation :</glossterm>
        <glossdef>
          <para>Definition of areas of interest in a volume or an image accoding some criterions. For example, if we want a white matter mask, we have to segment the brain according to grey levels.</para>
        </glossdef>
      </glossentry>
      <glossentry>
        <glossterm>SPM Talairach :</glossterm>
        <glossdef>
          <para>This one of the available referentials in Anatomist. It represents the Talairach referential used in SPM. This is the referential of images normalized with SPM.</para>
        </glossdef>
      </glossentry>
    </glossdiv>
    <glossdiv>
      <title>T</title>
      <glossentry>
        <glossterm>Talairach AC/PC :</glossterm>
        <glossdef>
          <para>Referential in Anatomist based on the anterior commissure position.</para>
        </glossdef>
      </glossentry>
      <glossentry>
        <glossterm>Texture :</glossterm>
        <glossdef>
          <para>Data used to put information on a mesh. There are 1D, 2D or 3D textures according to the number of information pieces by mesh element.</para>
        </glossdef>
      </glossentry>
    </glossdiv>
    <glossdiv>
      <title>V</title>
      <glossentry>
        <glossterm>4D Volume :</glossterm>
        <glossdef>
          <para>Volume that has 4 dimensions : x, y, z and t. For example, one 3D volume for each time unit. When a 4D volume is loaded in Anatomist and put in a window, the window gets 2 cursors, one for the 3D volume and the other for the 4th dimension. This 4th dimension can be the time or another dimension, for example the directions in a diffusion image.</para>
        </glossdef>
      </glossentry>
    </glossdiv>
  </glossary>
  <appendix id="ana_man%a_options" infoid="annexe sur les options d'Anatomist">
    <title><emphasis>anatomist</emphasis> command options
    </title>
    <para>
      <screen>  
      [ -i | --input &lt;vector of string>]  loads these files (conataining either Anatomist/AIMS objects, or .ana commands files)   
      [ -p | --pipe &lt;vector of string>]   open named pipe to read commands from (differs from normal .ana files loading in that the pipe is not closed once read, 
      	the pipe is reopened once flushed - using -p for a regular file results in infinite rereading of the same commands file)   
      [ -b | --batch &lt;boolean>]  batch mode: no control window (for remote control only, normally used with -p or a .ana input)   
      [ -s | --server &lt;S32>]  server mode: anatomist will listen on the given TCP port for command stream connections   
      [ -u | --userprofile &lt;string>]  user profile: all personal data will use the directory&lt;home_dir>/.anatomist-&lt;userprofile> rather than 
      	the default&lt;home_dir>/.anatomist   
      [ --enable-unstable &lt;boolean>]  Enables unstable features which may make Anatomist badly crash (experts only) (and nobody could tell you which features this incudes)   
      [ --cout &lt;string>]        redirect outpout messages to a file   
      [ --cerr &lt;string>]        redirect error messages to a file   
      [ --verbose [ &lt;S32>]]     Set verbosity level (default = 0, without value = 1)   
      [ -h | --help &lt;boolean>]  show help message   
      [ --version &lt;boolean>]    show Cartograph version   
      [ --info &lt;boolean>]       show libraries information (install, plugins, paths, etc.)
      </screen>
    </para>
  </appendix>
  
  <appendix id="ana_man%a_aims" infoid="indications sur Aims">
    <title>Display convention according to Aims version</title>
    <sect1>
      <title>Aims version before 2.13 </title>
      <para>Non-normalized images were read in radiological convention and displayed according to Anatomist configuration.</para>
      <para>Normalized images were read in neurological convention because of SPM 99. Indeed, SPM 99 always write normalized images in neurological convention.</para>
    </sect1>
    <sect1>
      <title>Aims version after 2.13 </title>
      <para>Since this version, normalized images are managed differently by Anatomist because of SPM 2. Indeed, images normalized with SPM2 can be in radiological or neurological convention, it depends on the source image. The output image keep the convention of the input image.</para>
      <para>So by default, Anatomist loads and displays images in radiological convention.</para>
      <para>A configuration file enables to modify theses loading and displaying parameter for a site or a user. For more details, see <xref linkend="ana_man%a_aimsrc"/> below.</para>     
    </sect1>
  </appendix>
  
  
  <appendix id="ana_man%a_aimsrc" infoid="description et utilisation du fichier .aimsrc">
    <title>Configuration file .aimsrc</title>
    <sect1><title>Utility</title>
      <para>This configuration file enables to adjust Anatomist behaviour when loading and displaying images in Analyze format... This configuration exsits since Aims 2.13. It can be useful for SPM99 and SPM2 users. 
        Indeed, the way normalized images are managed have changed between the 2 versions. See <xref linkend="ana_man%a_aims"/> above.
      </para>
      <para>To know which convention display should be used, Anatomist can search in several files in the following order :<itemizedlist>
          <listitem>
            <para>.minf file of the image</para>
          </listitem>
          <listitem>
            <para>If there is no information about the convention, Anatomist search for the user configuration file $HOME/.aimsrc </para>
          </listitem>
          <listitem>
            <para>If this file doesn't exist, the configuration file of aims is used : &lt;package&gt;/share/aims/.aimsrc or $AIMS_PATH/shared/aimsrc or $BRAINVISA_SHARE/aims/aimsrc.</para>
          </listitem>
        </itemizedlist>
      </para>
    </sect1>
    <sect1>
      <title>Syntax</title>
      <para>This configuration file's syntax is :</para>
      <para>
        <screen>attributes = {
	'__syntax__' : 'aims_settings',
        'spm_input_radio_convention' : 1,
        'spm_input_spm2_normalization' : 1,
        'spm_output_radio_convention' : 1,
        'spm_output_spm2_normalization' : 1,
        'spm_output_4d_volumes' : 1,
        'nifti_output_4d_volumes' : 1,  
	}</screen>
      </para>
      <para>Meaning of the different attributes : </para>
      <table>
        <title>.aimsrc file attributes</title>
        <tgroup align="justify" cols="2">
          <thead>
            <row>
              <entry>Attribute</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>
                <para>spm_input_radio_convention</para>
              </entry>
              <entry>
                <para>Convention that will be used to read and display images in Analyze format. </para>
                <para>0 : neurological convention</para>
                <para>1 : radiological convention</para>
              </entry>
            </row>
            <row>
              <entry>
                <para>spm_input_spm2_normalization</para>
              </entry>
              <entry>
                <para>Indicates if normalized images in Analyze format must be read with SPM99 or SPM2 convention.</para>
                <para>0 : SPM99, normalized images are always in neurological convention. This attributes has priority on <emphasis>spm_input_radio_convention</emphasis> attribute.</para>
                <para>1 : SPM2, the orientation is variable. <emphasis>spm_input_radio_convention</emphasis> is used to determine the convention.</para>
              </entry>
            </row>
            <row>
              <entry>
                <para>spm_output_radio_convention</para>
              </entry>
              <entry>
                <para>Indicates the convention that must be used when writing files in Analyze format if there is no other indication. This is useful when you convert from a format (eg. GIS) to Analyze format. However, if the source image has already Analyze format attributes, this configuration has no effect since the convention is given by the Analyze format attributes. </para>
                <para>0 : neurological convention.</para>
                <para>1 : radiological convention.</para>
              </entry>
            </row>
            <row>
              <entry>
                <para>spm_output_spm2_normalization</para>
              </entry>
              <entry>
                <para>Indicates if normalized images must be written in a format that reflects SPM99 or SPM2 behaviour. If the source image is already in Analyze format, the convention stay the same unless the <emphasis>spm_force_output_convention</emphasis> attribute is set.</para>
                <para>0 : SPM99 format</para>
                <para>1 : SPM2 format</para>
              </entry>
            </row>
            <row>
              <entry>
                <para>spm_output_4d_volumes</para>
              </entry>
              <entry>
                <para>Indicates if writing 4D volumes in Analyze format is allowed. Indeed, SPM99 cannot read 4D volumes, but SPM2 can.</para>
                <para>0 : forbids writing 4D volume.</para>
                <para>1 : allows writing 4D volume.</para>
              </entry>
            </row>
            <row>
              <entry>
                <para>nifti_output_4d_volumes</para>
              </entry>
              <entry>
                <para>Idem with Nifti format.</para>
              </entry>
            </row>
            <row>
              <entry>
                <para>spm_force_output_convention</para>
              </entry>
              <entry>
                <!-- Pas compris cette partie... cet attribut existe toujours ? il n'est pas dans le fichier aimsrc actuel. -->
                <para>Cet attribut permet de forcer l'criture d'une image au format ANALYZE en utilisant la valeur des attributs <emphasis>spm_output_radio_convention</emphasis> et<emphasis>spm_output_spm2_normalization</emphasis>.                 Par exemple, si une image est en convention   radiologique et que </para>
                <para>0 : prend par dfaut les caractristiques de l'image. Par exemple, si une image au format Analyze est en convention radiologique et que 
		l'attribut <emphasis>spm_output_radio_convention</emphasis> est  0, alors l'image sera rcrite en convention radiologique.</para>
                <para>1 : prend par dfaut les caractristiques des attributs <emphasis>spm_output_radio_convention</emphasis> et 
		 <emphasis>spm_output_spm2_normalization</emphasis>. Par exemple si une image au format Analyze est en convention radiologique et que 
		l'attribut <emphasis>spm_output_radio_convention</emphasis> est  0, alors l'image sera rcrite en convention neurologique.</para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      <para>If this file is not configured, images (normalized or not) are written in radiological convention.</para>
    </sect1>
  </appendix>
  
  <appendix id="ana_man%a_OS" infoid="differences between linux and windows versions of Anatomist">
    <title>Differences between linux and windows versions of Anatomist</title>
    <para>
      Windows version doesn't handle Vida format (.vimg).
    </para>
  </appendix>
  
  <!--
  <appendix id="ana_man%a_fmesh" infoid="description du format de maillage">
    <title>Format des maillages</title>
    <para/>
  </appendix>
  -->
  
  <!--
  <appendix id="ana_man%a_ftexture"  infoid="description du format de texture">
    <title>Format des textures</title>
    <para/>
  </appendix>
  -->
  <!---
  <appendix id="ana_man%a_fnomenclature"  infoid="description du format de nomenclature">
    <title>Format d'une nomenclature</title>
    <para/>
  </appendix>
  -->
  
  <appendix id="ana_man%a_fscriptana" infoid="description des fichiers scripts .ana" >
    <title>Anatomist script file (.ana)</title>
    <para>All actions done in Anatomist interface are stored in a file <filename>history.ana</filename> in your <filename>.anatomist</filename> directory (in C:\Documents and Settings\user_name under windows and /home/user_name under linux). You can save and reload this script to retrieve rapidly a session. When your session is ready (objects loaded, windows opened...), you have to save the <filename>history.ana</filename> by changing its name or copying it in another place else it will be erased the next time you start Anatomist. When you want to reload the session, start Anatomist using the anatomist command with the script filename as a parameter. For example : <command>anatomist /tmp/history.ana</command>. You can also load a script file by using the menu <emphasis>File -&gt; Replay scenario</emphasis>.
    </para>
  </appendix>
  
  <appendix id="ana_man%a_add_palette" infoid="how to add a palette">
    <title>Add a palette</title>
      <para><itemizedlist>
          <listitem>
            <para>Go into your .anatomist directory. It is <filename>C:\Documents and Settings\user_name\.anatomist</filename> under windows and <filename>/home/user_name/.anatomist</filename> under linux.</para>
          </listitem>
          <listitem>
            <para>Add a directory <emphasis>rgb</emphasis> if it doesn't exist yet.</para>
          </listitem>
          <listitem>
            <para>Put the palette files in it. It can be for example in GIS or JPG format.</para>
          </listitem>
          <listitem>
            <para>This new palette will be available in the list of palettes in Anatomist.</para>
          </listitem>
        </itemizedlist>
      </para>
  </appendix>
  
  <appendix id="ana_man%a_nom_sillon" infoid="Nomenclature des sillons">
    <title>Sulci nomenclature</title>
    <table>
      <title>Sulci nomenclature</title>
      <tgroup align="justify" cols="2">
        <colspec colname="c1"/>
        <colspec colname="c2"/>
        <spanspec nameend="c2" namest="c1" spanname="hspan"/>
        <thead>
          <row>
            <entry>Sulcus</entry>
            <entry>Name</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry spanname="hspan">Rgion centrale :</entry>
          </row>
          <row>
            <entry>S.C.</entry>
            <entry>sillon central</entry>
          </row>
          <row>
            <entry>
              <para/>
              <itemizedlist>
                <listitem>
                  <para>S.C.sup </para>
                </listitem>
                <listitem>
                  <para>S.C.inf </para>
                </listitem>
              </itemizedlist>
              <!-- <simplelist type="vert">
                <member>S.C.sup</member>
                <member>S.C.inf</member>
              </simplelist>-->
            </entry>
            <entry>
              <para/>
              <itemizedlist>
                <listitem>
                  <para>suprieur</para>
                </listitem>
                <listitem>
                  <para>infrieur</para>
                </listitem>
              </itemizedlist>
            </entry>
          </row>
          <row>
            <entry spanname="hspan"/>
          </row>
          <row>
            <entry spanname="hspan">F.C.L : valle sylvienne (fissure crbrale latrale) </entry>
          </row>
          <row>
            <entry>F.C.L.a.</entry>
            <entry>FCL antrieure</entry>
          </row>
          <row>
            <entry>F.C.L.r.ant.</entry>
            <entry>rameau antrieur</entry>
          </row>
          <row>
            <entry>F.C.L.r.asc.</entry>
            <entry>rameau ascendant</entry>
          </row>
          <row>
            <entry>F.C.L.p.</entry>
            <entry>FCL postrieure</entry>
          </row>
          <row>
            <entry>F.C.L.r.diag.</entry>
            <entry>rameau diagonal</entry>
          </row>
          <row>
            <entry>F.C.L.r.sc.ant.</entry>
            <entry>rameau sub-central antrieur</entry>
          </row>
          <row>
            <entry>F.C.L.r.sc.post.</entry>
            <entry>rameau sub-central postrieur</entry>
          </row>
          <row>
            <entry>F.C.L.r.retroC.tr.</entry>
            <entry>rameau rtro-central transverse</entry>
          </row>
          <row>
            <entry spanname="hspan"/>
          </row>
          <row>
            <entry spanname="hspan">Rgion prcentrale : </entry>
          </row>
          <row>
            <entry>S.Pe.C.median.</entry>
            <entry>sillon prcentral mdian</entry>
          </row>
          <row>
            <entry>S.Pe.C.marginal.</entry>
            <entry>sillon prcentral marginal</entry>
          </row>
          <row>
            <entry>S.Pe.C.sup.</entry>
            <entry>sillon prcentral suprieur</entry>
          </row>
          <row>
            <entry>S.Pe.C.inter.</entry>
            <entry>sillon prcentral intermdiaire</entry>
          </row>
          <row>
            <entry>S.Pe.C.inf.</entry>
            <entry>sillon prcentral infrieur</entry>
          </row>
          <row>
            <entry spanname="hspan"/>
          </row>
          <row>
            <entry spanname="hspan">Lobe frontal :</entry>
          </row>
          <row>
            <entry>S.F.median.</entry>
            <entry>sillon frontal mdian</entry>
          </row>
          <row>
            <entry>
              <para>S.F.sup.</para>
              <itemizedlist>
                <listitem>
                  <para>S.F.sup.ant.</para>
                </listitem>
                <listitem>
                  <para>S.F.sup.moy. </para>
                </listitem>
                <listitem>
                  <para>S.F.sup.post. </para>
                </listitem>
              </itemizedlist>
            </entry>
            <entry>
              <para>sillon frontal suprieur</para>
              <itemizedlist>
                <listitem>
                  <para>(antrieur)</para>
                </listitem>
                <listitem>
                  <para>(moyen)</para>
                </listitem>
                <listitem>
                  <para>(postrieur)</para>
                </listitem>
              </itemizedlist>
            </entry>
          </row>
          <row>
            <entry>
              <para>S.F.inter.</para>
              <itemizedlist>
                <listitem>
                  <para>  S.F.inter.ant.</para>
                </listitem>
                <listitem>
                  <para>   S.F.inter.moy. </para>
                </listitem>
                <listitem>
                  <para>   S.F.inter.post. </para>
                </listitem>
              </itemizedlist>
            </entry>
            <entry>
              <para>sillon frontal intermdiaire</para>
              <itemizedlist>
                <listitem>
                  <para>(antrieur)</para>
                </listitem>
                <listitem>
                  <para>(moyen)</para>
                </listitem>
                <listitem>
                  <para>(postrieur)</para>
                </listitem>
              </itemizedlist>
            </entry>
          </row>
          <row>
            <entry>
              <para>S.F.inf.</para>
              <itemizedlist>
                <listitem>
                  <para> S.F.inf.ant.</para>
                </listitem>
                <listitem>
                  <para> S.F.inf.moy.   </para>
                </listitem>
                <listitem>
                  <para>    S.F.inf.post.</para>
                </listitem>
              </itemizedlist>
            </entry>
            <entry>
              <para>sillon frontal infrieur</para>
              <itemizedlist>
                <listitem>
                  <para> S.F.inf.ant.</para>
                </listitem>
                <listitem>
                  <para> S.F.inf.moy.   </para>
                </listitem>
                <listitem>
                  <para>    S.F.inf.post.</para>
                </listitem>
              </itemizedlist>
            </entry>
          </row>
          <row>
            <entry>S.F.polaire.tr</entry>
            <entry>sillon fronto-polaire transverse</entry>
          </row>
          <row>
            <entry>S.F.marginal.</entry>
            <entry>sillon frontal marginal</entry>
          </row>
          <row>
            <entry>S.F.orbitaire.</entry>
            <entry>sillon fronto-orbitaire</entry>
          </row>
          <row>
            <entry>S.Olf.</entry>
            <entry>sillon olfactif</entry>
          </row>
          <row>
            <entry>S.Or.</entry>
            <entry>sillon orbitaire</entry>
          </row>
          <row>
            <entry>S.Or.l.</entry>
            <entry>sillon orbitaire latral</entry>
          </row>
          <row>
            <entry spanname="hspan"/>
          </row>
          <row>
            <entry spanname="hspan">Face interne frontale :</entry>
          </row>
          <row>
            <entry>S.F.int.</entry>
            <entry>sillon frontal interne</entry>
          </row>
          <row>
            <entry>
              <para/>
              <itemizedlist>
                <listitem>
                  <para> S.F.int.pol.</para>
                </listitem>
                <listitem>
                  <para> S.F.int.sup</para>
                </listitem>
                <listitem>
                  <para> S.F.int.AMS</para>
                </listitem>
              </itemizedlist>
            </entry>
            <entry>
              <para/>
              <itemizedlist>
                <listitem>
                  <para>(polaire)</para>
                </listitem>
                <listitem>
                  <para>(suprieur)</para>
                </listitem>
                <listitem>
                  <para>sillon frontal interne de l'aire motrice supplmentaire</para>
                </listitem>
              </itemizedlist>
            </entry>
          </row>
          <row>
            <entry>S.R.sup.</entry>
            <entry>sillon rostral suprieur</entry>
          </row>
          <row>
            <entry>S.R.inf.</entry>
            <entry>(infrieur)</entry>
          </row>
          <row>
            <entry>
              <para>F.C.M.ant.</para>
              <itemizedlist>
                <listitem>
                  <para> F.C.M.ant.</para>
                </listitem>
                <listitem>
                  <para> F.C.M.sup.r.asc.ant.</para>
                </listitem>
              </itemizedlist>
            </entry>
            <entry>
              <para>fissure calloso-marginale antrieure</para>
              <itemizedlist>
                <listitem>
                  <para>-</para>
                </listitem>
                <listitem>
                  <para>rameau ascendant antrieur</para>
                </listitem>
              </itemizedlist>
            </entry>
          </row>
          <row>
            <entry>F.C.M.post.</entry>
            <entry>(postrieure)</entry>
          </row>
          <row>
            <entry>F.C.M.r.AMS.ant.</entry>
            <entry>rameau de l'aire motrice supplmentaire</entry>
          </row>
          <row>
            <entry>S.p.C.</entry>
            <entry>sillon paracentral</entry>
          </row>
          <row>
            <entry>S.Call.</entry>
            <entry>sillon sous-calleux</entry>
          </row>
          <row>
            <entry>S.C.LPC.</entry>
            <entry>sillon central du lobule paracentral</entry>
          </row>
          <row>
            <entry spanname="hspan"/>
          </row>
          <row>
            <entry spanname="hspan">Face interne postrieure :</entry>
          </row>
          <row>
            <entry>S.s.P.</entry>
            <entry>sillon sous-parital</entry>
          </row>
          <row>
            <entry>S.Pa.int.</entry>
            <entry>sillon parital interne</entry>
          </row>
          <row>
            <entry>F.P.O.</entry>
            <entry>fissure parito-occipitale</entry>
          </row>
          <row>
            <entry>S.Cu.</entry>
            <entry>sillon cunal</entry>
          </row>
          <row>
            <entry>S.Li.</entry>
            <entry>sillon intra-lingual</entry>
          </row>
          <row>
            <entry spanname="hspan"/>
          </row>
          <row>
            <entry spanname="hspan">Lobe parital :</entry>
          </row>
          <row>
            <entry>S.Pa.sup.</entry>
            <entry>sillon parital suprieur</entry>
          </row>
          <row>
            <entry>S.Pa.t.</entry>
            <entry>sillon parital transverse</entry>
          </row>
          <row>
            <entry>S.Po.C.sup.</entry>
            <entry>sillon post-central suprieur</entry>
          </row>
          <row>
            <entry>(S.GSM.)</entry>
            <entry>sillon du gyrus supra-marginal</entry>
          </row>
          <row>
            <entry>
              <para>F.I.P.</para>
              <itemizedlist>
                <listitem>
                  <para> F.I.P.</para>
                </listitem>
                <listitem>
                  <para> F.I.P.Po.C.sup.</para>
                </listitem>
                <listitem>
                  <para> F.I.P.r.trans.</para>
                </listitem>
                <listitem>
                  <para> F.I.P.Horiz.</para>
                </listitem>
                <listitem>
                  <para>F.I.P.ParO.</para>
                </listitem>
              </itemizedlist>
            </entry>
            <entry>
              <para>fissure inter-paritale</para>
              <itemizedlist>
                <listitem>
                  <para>-</para>
                </listitem>
                <listitem>
                  <para>partie post-centrale suprieure</para>
                </listitem>
                <listitem>
                  <para>rameau transverse</para>
                </listitem>
                <listitem>
                  <para>FIP horizontale</para>
                </listitem>
                <listitem>
                  <para>parito-occipital</para>
                </listitem>
              </itemizedlist>
            </entry>
          </row>
          <row>
            <entry>F.I.P.Po.C.inf.</entry>
            <entry>partie post-centrale infrieure</entry>
          </row>
          <row>
            <entry>F.I.P.r.int.1</entry>
            <entry>rameau intermdiaire primaire</entry>
          </row>
          <row>
            <entry>F.I.P.r.int.2</entry>
            <entry>rameau intermdiaire secondaire</entry>
          </row>
          <row>
            <entry spanname="hspan"/>
          </row>
          <row>
            <entry spanname="hspan">Lobe occipital :</entry>
          </row>
          <row>
            <entry>OCCIPITAL</entry>
            <entry>(non dtaill)</entry>
          </row>
          <row>
            <entry spanname="hspan">Complexe calcarin :</entry>
          </row>
          <row>
            <entry>F.Cal.ant.-Sc.Cal.</entry>
            <entry>fissure calcarine antrieure et scissure calcarine (la segmentation fusionne souvent ces deux sillons)</entry>
          </row>
          <row>
            <entry>S.O.p.</entry>
            <entry>Sillon occipito-polaire</entry>
          </row>
          <row>
            <entry spanname="hspan"/>
          </row>
          <row>
            <entry spanname="hspan">Lobe temporal externe : </entry>
          </row>
          <row>
            <entry>S.T.pol.</entry>
            <entry>sillon temporal polaire</entry>
          </row>
          <row>
            <entry>S.T.s.</entry>
            <entry>sillon temporal suprieur</entry>
          </row>
          <row>
            <entry>S.T.s.ter.asc.ant.</entry>
            <entry>branche terminale ascendante antrieure</entry>
          </row>
          <row>
            <entry>S.T.s.ter.asc.post.</entry>
            <entry>branche terminale ascendante postrieure</entry>
          </row>
          <row>
            <entry>S.T.i.ant.</entry>
            <entry>sillon temporal infrieur antrieur</entry>
          </row>
          <row>
            <entry>S.T.i.post.</entry>
            <entry>sillon temporal infrieur postrieur</entry>
          </row>
          <row>
            <entry spanname="hspan"/>
          </row>
          <row>
            <entry spanname="hspan">Lobe temporal basal :</entry>
          </row>
          <row>
            <entry>S.O.T.lat.ant.</entry>
            <entry>sillon occipito-temporal latral antrieur</entry>
          </row>
          <row>
            <entry>S.O.T.lat.post.</entry>
            <entry>(postrieur)</entry>
          </row>
          <row>
            <entry>F.Coll.</entry>
            <entry>fissure collatrale</entry>
          </row>
          <row>
            <entry>S.Rh.</entry>
            <entry>sillon rhinal</entry>
          </row>
          <row>
            <entry spanname="hspan"/>
          </row>
          <row>
            <entry spanname="hspan">Insula :</entry>
          </row>
          <row>
            <entry>INSULA</entry>
            <entry>(non dtaille)</entry>
          </row>
        </tbody>
      </tgroup>
    </table>
    <figure>
      <title>Automatic recognition of sulci for subject A, external side (BrainVISA process <emphasis>Sulci => morphometry => automatic recognition </emphasis>)</title>
	<mediaobject>
	<imageobject role="fop"><imagedata fileref="&DIR_IMG;nomsillons1.png" format="PNG"  width="400"/></imageobject>
	<imageobject role="html"><imagedata fileref="&DIR_IMG;nomsillons1.png" format="PNG"/></imageobject>
	</mediaobject>
    </figure>	
 
    <figure>
      <title>Automatic recognition of sulci for subject A, intern (BrainVISA process <emphasis>Sulci => morphometry => automatic recognition </emphasis>)</title>
	<mediaobject>
	<imageobject role="fop"><imagedata fileref="&DIR_IMG;nomsillons2.png" format="PNG"  width="400"/></imageobject>
	<imageobject role="html"><imagedata fileref="&DIR_IMG;nomsillons2.png" format="PNG"/></imageobject>
	</mediaobject>
    </figure>	
  </appendix>
  
  <appendix id="ana_man%a_fanahis" infoid="description du fichier .anahis obtenu dans module de ROI">
    <title>.anahis format : histogram data obtained via the connexity threshold tool</title>
    <para>  Data obtained from a T1 volume and a ROI (region1) drawn with the ROI drawing module. Bin = 10</para>
    <para>
      <screen> 
      lesson1.ima histogram :             
      Bin|          Color|         Number| Percentage (%)               
      0|              0|    3.47895e+06|        48.9364               
      1|        36.7755|         633689|        8.91373               
      2|        73.5509|         448951|        6.31513               
      3|        110.326|         608268|        8.55614               
      4|        147.102|         906758|        12.7548               
      5|        183.877|         632822|        8.90153               
      6|        220.653|         369769|        5.20132               
      7|        257.428|          24945|       0.350886               
      8|        294.204|           4518|       0.063552               
      9|        330.979|            457|     0.00642835              
      10|        367.755|              7|    9.84648e-05  
       
      lesson1_ROI histogram :  region1 Mean Value = 1915.45 Sdt Deviation = 443.36 Histogram :             
      Bin|          Color|         Number| Percentage (%)              
       0|              0|            229|      0.0877408               
       1|          409.5|           3140|        1.20308              
       2|            819|          10576|        4.05217               
       3|         1228.5|          17805|        6.82194               
       4|           1638|          72446|        27.7575               
       5|         2047.5|          81685|        31.2974               
       6|           2457|          75089|        28.7702               
       7|         2866.5|             26|     0.00996184               
       8|           3276|              0|              0               
       9|         3685.5|              0|              0</screen>
    </para>
  </appendix>
   
</book>

